# STRICT_MODE: قواعد الالتزام الحرفية لتوليد الموديلات وملفات الدومين (نسخة مطورة ومحسنة)

> **تنبيه:** يمنع الخروج عن هذه القواعد نهائيًا. يجب الالتزام بها بدقة تامة في كل خطوة.

---

## الخطوات الأساسية لاستخراج الحقول والعلاقات

1. **يجب أولًا الاطلاع على ملف الترقيم وتخطيط الأسماء:**
   - المسار: `https://github.com/abo-bahr-alqershi/OnyxQ/blob/main/table_models_mapping.txt`
   - هذا الملف يحدد:
     - رقم الجدول
     - اسم الجدول القديم
     - اسم الموديل الجديد المطلوب إنشاؤه
   - يجب استخدام هذا الملف لاستخلاص التسمية الجديدة والقديمة لكل موديل، واعتماد الترقيم الصحيح لكل جدول/موديل.

2. **تحليل ملف البنية مباشرة (بدون سكربت):**
   - استخرج الحقول والمفاتيح والعلاقات مباشرة من الملف:
     - `https://github.com/abo-bahr-alqershi/OnyxQ/blob/main/output_tmp.json`
   - استخدم أسماء الجداول القديمة كما وردت في ملف الترقيم للبحث عن تفاصيلها في ملف البنية.
   - استخرج جميع الحقول، المفاتيح، والعلاقات المرتبطة لكل جدول.
   - لا تعتمد على أي سكربت وسيط؛ التحليل يجب أن يكون مباشرًا من الملف.

3. **إذا لم تتمكن من استخراج أي معلومة من المصدرين أعلاه (الترقيم + البنية)، توقف فورًا عن التنفيذ ولا تتابع أي خطوة.**
   - يجب أن تكون جميع المعلومات واضحة وموجودة في المصدرين.
   - إذا كان هناك أي نقص، أبلغ المستخدم بذلك كمقترح لتحديث المصادر.

---

## الشروط العامة

1. **اتبع معمارية Clean Architecture** بجميع تفاصيلها.
   - استخدم طبقة common المناسبة في الدومين لكل كيانات المشروع.
   - يجب الاستفادة من جميع الكائنات المشتركة (Common) المتوفرة في طبقة الدومين (مثل: AuditableEntity, IAggregateRoot, EntityBase…) حسب ما يلزم كل موديل.
   - إذا كانت هناك خصائص عامة (كالتدقيق، التواريخ، المعرفات المشتركة...) مشمولة في كائنات Common، فلا تعيد تعريفها بل استخدم الوراثة بشكل صحيح مع التوثيق.
2. **استخدم EVENTS وVALUEOBJECTS وENUMS بشكل كامل واحترافي:**
   - افحص كامل الأحداث الممكنة أو المتوقعة لكل Entity (باستخدام خبرتك في الأنظمة الحديثة وERP)، وقم بإنشاء جميع الأحداث (Domain Events) اللازمة لجعل الموديل قويًا ومطوّرًا ويدعم السيناريوهات المستقبلية، وليس فقط الأحداث الأساسية.
   - يجب كتابة جميع **الدوال الخاصة بالأحداث (Event Methods)** من داخل الموديل نفسه (Entity)، بحيث يتم توليد الأحداث المناسبة (Domain Events) عند استدعاء هذه الدوال، لضمان تكامل الأحداث مع منطق الكيان ورفع قوة النظام.
   - أنشئ ValueObjects لكل مجموعة خصائص منطقية مركبة أو متكررة أو ذات معنى مستقل لتحسين بنية النظام ورفع قوة المعمارية. قم بتحليل جميع خصائص الموديل وحدد ما يلزم أن يكون ضمن ValueObject، مع الحفاظ الكامل على جميع الحقول الأصلية للموديل (لا يُنقص أي حقل إطلاقًا).
   - أنشئ ملفات Enumerations مفصلة لأي قيم ثابتة أو خيارات (مثال: BranchStatus)، مع شرح مفصل لكل قيمة.
3. **أضف توثيقًا مفصلًا وشرحًا واضحًا** أعلى كل موديل، وكل خاصية، وكل حدث، وكل Enum، مع توضيح التسمية القديمة (واسم الجدول والرقم).
4. **لا يجوز إزالة أو حذف أو اختصار أي حقل من الموديل إطلاقًا** (حتى لو تم نقله إلى ValueObject يجب أن يبقى ممثلًا بالكامل)، ويجب الحفاظ على جميع الحقول كما هي في جدول المصدر.
5. **اتبع الترقيم للموديلات** كما في ملف تخطيط الجداول، واذكره بوضوح في التوثيق أعلى كل موديل.
6. **أي حقل أو مفتاح أو علاقة في ملف البنية يجب أن يوجد في الموديل**، لا يجوز إغفال أي خاصية (حتى لو أدرجت داخل ValueObject مع التوثيق).
   - يجوز إضافة خصائص جديدة فقط إذا كانت ضرورية لمزايا إضافية واضحة وتوثق ذلك.
7. **العلاقات يجب أن تُدرج كاملة وبدون نقص إطلاقًا**، مع مراعاة الأنواع (one-to-many, many-to-one, ...)، حتى لو لم يكن الموديل الآخر موجودًا بعد، يجب إضافتها وتوثيقها بوضوح.
8. **أنشئ جميع الأحداث اللازمة** بحسب خبرتك وتوقعك لما يناسب أنظمة ERP الحديثة، وادعم الموديل بأحداث إضافية مستقبلية لتغطية كافة السيناريوهات الممكنة (مثلاً: إضافة، تحديث، حذف، تغيير حالة، ربط بفروع أخرى... إلخ)، مع التأكيد على كتابة دوال الأحداث الخاصة بها داخل الموديل.
9. **المفاتيح الرئيسية** للموديلات كما في الجداول الأصلية بلا تغيير.
10. **حافظ على نمط التسمية الحديث للحقول** مع ذكر الاسم القديم بجانب كل خاصية في تعليق يبدأ بـ `!#` داخل `/**/` ويشمل شرحًا موجزًا بالعربية.
11. **أضف ملفات Enum المطلوبة بشكل تفصيلي ودقيق، مع شرح لكل قيمة**.
12. **لا تتوقف حتى تكمل المهمة بالكامل** التي طُلبت منك.
13. **التزم بهيكلية تقسيم المجلدات:**
    - كل موديول داخل الدومين يحتوي على:
      - Entities
      - Events
      - ValueObjects
      - Enums
      - Common (إن وجد)
14. **عند وجود أي خروج عن الخطة أو القواعد أو جزء غير مغطى من طبقة الـCommon**، أبلغ المستخدم كمقترح قبل التنفيذ وانتظر الموافقة أو الرفض منه.
15. **التعامل مع علاقات الـNavigation Properties يجب أن يكون كاملًا (جمع/مفرد) مع توثيق العلاقة واسم الجدول/الموديل القديم** في تعليق يبدأ بـ `@#` داخل `/**/`.
16. **أنشئ Constructors خاصة وعامة للموديل مع تهيئة الخصائص والـCollections المناسبة.**
17. **أضف طرق Domain Methods منطقية (مثال: Update, ChangeStatus, AddDocument ...إلخ) مع توليد الأحداث المناسبة عند كل عملية، ويجب أن تُكتب دوال الأحداث من داخل الموديل مباشرة.**
18. **التزم بإظهار كافة ملفات الدومين للموديل (Entity, Events, ValueObjects, Enums ...) بشكل متكامل ومترابط.**

---

## معايير إضافية متقدمة

19. **تجميع الخصائص المنطقية في ValueObjects وإنشاؤها بذكاء:**
    - يجب فحص جميع الحقول وتحليلها لتجميع الحقول التي تشترك في وظيفة أو معنى مشترك (مثل بيانات الاتصال، بيانات العنوان، بيانات الهوية، وغيرها) داخل ValueObjects جديدة باسم واضح ومعبر.
    - لا تكتفِ بتجميع الحقول التي تكون مجموعة في الجدول فقط، بل استخدم خبرتك البرمجية لتحديد الحقول التي يمكن أن تتجمع منطقياً في ValueObjects حتى وإن لم تكن مجمعة في قاعدة البيانات.
    - على كل ValueObject أن يحتوي خصائص واضحة، مع توثيق ثنائي اللغة وذكر أصل كل خاصية من الجدول.

20. **كتابة دوال Domain Methods والأحداث من داخل الكيان:**
    - يجب إنشاء جميع دوال Domain Methods المنطقية (مثل: إضافة، تحديث، تغيير حالة، تغيير تفاصيل، حذف، ...إلخ) داخل الكيان نفسه.
    - كل دالة يجب أن تولّد الحدث المناسب (Domain Event) مباشرة باستدعاء AddDomainEvent(new EventName(...)).
    - الأحداث يجب أن تغطي جميع السيناريوهات المتوقعة لأي تغيير جوهري في الكيان أو علاقاته، وأن يكون لها أسماء واضحة ومعبرة.
    - يجب توثيق كل دالة حدث باللغتين وشرح متى ولماذا تُستخدم.

21. **كتابة التعليقات والتوثيق الثنائي:**  
    - يجب كتابة شرح ثنائي اللغة (عربي/إنجليزي) لكل خاصية، ولكل دالة، ولكل حدث.
    - يجب ذكر اسم الحقل القديم من الجدول في تعليق خاص بجوار كل خاصية.

22. **تنظيم الكود بمناطق Regions:**  
    - يجب تنظيم الكود باستخدام #region لكل جزء رئيسي (Properties, Navigation Properties, Constructors, Methods) لسهولة القراءة والصيانة.

23. **كتابة Constructors خاصة وعامة:**  
    - يجب توفير Constructor خاص (لـ EF Core أو ORM) وConstructor عام يحتوي كل الخصائص الأساسية المطلوبة لإنشاء الكيان بشكل صحيح.

24. **تمثيل العلاقات بشكل كامل واحترافي:**  
    - يجب تمثيل جميع العلاقات (Navigation Properties) مع توثيق وتوضيح اسم الجدول القديم وسبب العلاقة.
    - إذا لم يوجد الطرف الآخر للعلاقة بعد، يجب ذكر ذلك في تعليق خاص.

25. **وراثة الكيانات المشتركة دون تكرار خصائصها:**  
    - يجب التأكد أن الكيان يرث من الكيانات المشتركة اللازمة (مثل: AuditableEntity, IAggregateRoot) مع عدم تكرار الخصائص الموجودة في تلك الكيانات.

---

## قاعدة إضافية هامة (تمييز الحقول الأساسية):

26. **يجب توضيح الحقول التي هي مفاتيح رئيسية (Primary Keys) صراحةً في كل موديل عند توليد الملفات.**
    - يجب ذكر ذلك بوضوح في التعليقات بجانب كل خاصية مفتاح رئيسي، مع توثيق ثنائي اللغة (عربي/إنجليزي).
    - يجب عدم إخفاء أو اختصار أو دمج المفتاح الرئيسي مع خاصية أخرى.
    - عند وجود مفتاح مركب (Composite Key) يجب توثيقه وشرحه بشكل دقيق في أعلى الموديل وداخل خصائصه.

---

## قواعد التنفيذ والتوقف

- **المصدران الوحيدان لاستخراج الحقول والعلاقات هما:**
  1. ملف تخطيط الجداول القديم إلى الموديلات الجديدة (`https://github.com/abo-bahr-alqershi/OnyxQ/blob/main/table_models_mapping.txt`)
  2. ملف البنية (`https://github.com/abo-bahr-alqershi/OnyxQ/blob/main/output_tmp.json`)
- إذا لم تتمكن من استخراج أي معلومة من المصدرين أعلاه، **توقف فورًا ولا تتابع التنفيذ** حتى يتم حل المشكلة أو تحديث المصادر.
- لا تبرر أو تشرح أي خطوة أثناء التنفيذ؛ فقط نفذ المهمة كما هي مطلوبة.
- **لا تطرح أسئلة توضيحية إلا في حالة وجود مشكلة حقيقية في القواعد أو المصادر.**
- **عند وجود خروج عن الخطة أو القواعد أو عند وجود جزء في طبقة الـcommon أو الدومين غير مغطى**، أبلغني كمقترح وانتظر موافقتي أو رفضي.

---

## ملخص التنفيذ التلقائي

- لا تطرح أسئلة توضيحية.
- إذا نقصت معلومة، افترض أفضل فرضية معقولة وأكمل التنفيذ مع توثيق الافتراض في التعليق.
- لا تبرر اختياراتك ولا تبين منطقك أثناء العمل؛ فقط نتائج نهائية واضحة وموثقة.
- عند وجود أي لبس أو ضرورة لتغيير القواعد أو الخطة، أبلغ المستخدم بذلك كمقترح قبل التنفيذ.

---

**يجب الالتزام التام بهذه القواعد في كل خطوة دون أي استثناء، مع ضمان الاستفادة الكاملة من طبقة الـcommon عند كتابة أي موديل أو ملف تابع له، وعدم نسيان أي حقول، أو علاقات، أو أحداث، أو متطلبات من ملفات الجداول والعلاقات والترايجرز المرسلة، وكتابة جميع دوال الأحداث من داخل الموديل مباشرة، وإبلاغ المستخدم بأي خروج عن القواعد أو الخطة كمقترح.**

# شاشة تقارير الإغلاق (Closing Reports)

## نظرة عامة
شاشة تقارير الإغلاق هي واحدة من الشاشات الأساسية في نظام الأونكس برو ERP، وتُستخدم لإنشاء وعرض وطباعة مجموعة من التقارير المالية والمحاسبية المتعلقة بعمليات الإغلاق الدورية (شهرية، ربعية، سنوية). تعتبر هذه الشاشة أداة محورية تدعم المحاسبين والمدراء الماليين في توثيق ومراجعة وتدقيق عمليات الإغلاق وضمان دقة البيانات المالية واكتمالها.

توفر هذه الشاشة مجموعة متكاملة من التقارير التفصيلية التي تعرض الوضع المالي للمؤسسة عند نقاط الإغلاق، وتساعد في عمليات التسوية والمطابقة والتحليل. كما تتميز بقدرات متقدمة للتخصيص والتصفية وحفظ إعدادات التقارير المستخدمة بشكل متكرر، مما يسهل على المستخدمين الوصول السريع للمعلومات المالية الحيوية وتقديمها بالشكل المناسب للمراجعة والتدقيق الداخلي والخارجي.

## مكونات واجهة المستخدم

### القسم العلوي (شريط الأدوات)
- **شريط العنوان**: يعرض عنوان الشاشة وأيقونات التحكم
- **شريط القوائم**: يحتوي على قوائم منسدلة للوصول للوظائف المختلفة
- **شريط الأدوات الرئيسي**: يحتوي على أزرار للوظائف الأكثر استخدامًا
- **مؤشر الفترة المحاسبية**: يعرض الفترة المحاسبية النشطة حاليًا
- **مؤشر حالة الإغلاق**: يوضح حالة عملية الإغلاق الحالية
- **أزرار التنقل السريع**: للانتقال بين التقارير المختلفة
- **أيقونة الشركة/الفرع**: تعرض الشركة والفرع الحالي
- **أزرار مهام سير العمل**: للوصول لمهام الإغلاق المطلوبة
- **أزرار التحكم في العرض**: للتحكم في طريقة عرض التقارير

### منطقة اختيار التقارير
- **شجرة تصنيف التقارير**: تنظم التقارير في مجموعات منطقية
  - تقارير الإغلاق الشهري
  - تقارير الإغلاق الربع سنوي
  - تقارير الإغلاق السنوي
  - تقارير التسويات
  - تقارير المطابقة
  - تقارير التدقيق والمراجعة
- **قائمة التقارير المفضلة**: عرض وإدارة التقارير المستخدمة بشكل متكرر
- **قائمة التقارير الأخيرة**: عرض آخر التقارير التي تم الوصول إليها
- **حقل البحث عن التقارير**: للبحث السريع عن تقرير محدد
- **قسم القوالب والنماذج**: لإدارة قوالب التقارير المخصصة
- **أزرار إنشاء تقارير جديدة**: لإنشاء تقارير مخصصة جديدة
- **أزرار إدارة التقارير**: لإدارة قوالب ومجموعات التقارير

### منطقة معايير التقرير
- **اختيار الفترة**: تحديد الفترة المالية للتقرير
  - حقول التاريخ (من - إلى)
  - اختيار سريع للفترات (الشهر الحالي، الربع الحالي، السنة الحالية)
  - خيارات المقارنة مع فترات سابقة
- **اختيار الفروع**: تحديد الفروع المشمولة في التقرير
- **اختيار العملة**: تحديد العملة الرئيسية للتقرير
- **اختيار مستوى التفاصيل**: تحديد مستوى تفصيل البيانات
- **خيارات العرض**: تحديد طريقة عرض وتنظيم البيانات
- **خيارات التصفية المتقدمة**: تخصيص معايير التصفية الإضافية
- **حفظ المعايير**: إمكانية حفظ مجموعات المعايير المستخدمة بشكل متكرر
- **استدعاء المعايير المحفوظة**: استخدام معايير محفوظة سابقًا

### منطقة عرض التقرير
- **عرض البيانات الرئيسي**: يعرض بيانات التقرير في نسق مناسب
  - عرض جدولي للبيانات الرقمية
  - عرض رسومي (مخططات بيانية)
  - عرض مختلط (جداول ورسوم بيانية)
- **أشرطة التمرير**: للتنقل في التقارير الكبيرة
- **شريط التفاصيل**: يعرض تفاصيل إضافية عن العنصر المحدد
- **منطقة الإجماليات**: تعرض ملخصات وإجماليات البيانات
- **منطقة الملاحظات**: تعرض الملاحظات والتنبيهات المتعلقة بالتقرير
- **منطقة المؤشرات**: تعرض مؤشرات الأداء الرئيسية والانحرافات
- **شريط الحالة**: يعرض معلومات إضافية عن حالة التقرير

### أدوات التصدير والمشاركة
- **أزرار التصدير**: لتصدير التقرير بتنسيقات مختلفة
  - تصدير إلى Excel
  - تصدير إلى PDF
  - تصدير إلى XML
  - تصدير إلى CSV
- **أزرار الطباعة**: لطباعة التقرير أو معاينته قبل الطباعة
- **أدوات المشاركة**: لمشاركة التقرير مع مستخدمين آخرين
  - إرسال بالبريد الإلكتروني
  - حفظ كمرفق في نظام المستندات
  - مشاركة رابط للتقرير
- **أزرار جدولة التقارير**: لإعداد جدولة تلقائية للتقارير 


## الوظائف الرئيسية

### إنشاء وتخصيص التقارير
1. **إنشاء تقارير جديدة**:
   - اختيار نوع التقرير من القائمة المتاحة
   - تعيين اسم ووصف للتقرير
   - تحديد الفترة المالية المطلوبة
   - اختيار تخطيط وتنسيق التقرير
   - تحديد مستوى التفاصيل المطلوب
   - حفظ التقرير للاستخدام المستقبلي

2. **تخصيص معايير التقارير**:
   - تحديد نطاق البيانات (تاريخ البدء والانتهاء)
   - اختيار الحسابات المشمولة في التقرير
   - تخصيص معايير التصفية والفرز
   - تحديد مستويات التجميع والتفصيل
   - إضافة حسابات أو عناصر مخصصة
   - تعيين قواعد مخصصة للتنبيهات والتحذيرات

3. **تنظيم وإدارة التقارير**:
   - تصنيف التقارير في مجموعات منطقية
   - إضافة التقارير المهمة إلى المفضلة
   - إعادة تسمية وتنظيم التقارير الموجودة
   - إنشاء نسخ جديدة من التقارير الموجودة
   - مشاركة التقارير مع مستخدمين آخرين
   - تعيين مستويات الوصول والصلاحيات

4. **إنشاء قوالب تقارير**:
   - حفظ إعدادات التقارير كقوالب
   - تطبيق القوالب على تقارير جديدة
   - مشاركة القوالب عبر المؤسسة
   - تخصيص هيكل ومظهر القوالب
   - تعيين القوالب الافتراضية لأنواع التقارير
   - إنشاء قوالب لمختلف أنواع التقارير

### توليد وعرض التقارير
1. **توليد تقارير الإغلاق**:
   - توليد التقرير بناءً على المعايير المحددة
   - اختيار فترة التقرير (شهري، ربع سنوي، سنوي)
   - تطبيق التخصيصات والمعايير المحفوظة
   - معالجة البيانات من مختلف المصادر
   - التحقق من اكتمال ودقة البيانات
   - توليد التقارير بشكل فوري أو مجدول

2. **عرض وتحليل البيانات**:
   - عرض البيانات بتنسيقات متعددة (جدول، رسم بياني)
   - تصفية وفرز البيانات المعروضة
   - التكبير والتصغير في مستويات التفاصيل
   - إجراء تحليلات مباشرة على البيانات
   - مقارنة البيانات مع فترات سابقة
   - تحديد الانحرافات والاتجاهات المهمة

3. **التفاعل مع التقارير**:
   - التنقل بين أقسام التقرير المختلفة
   - توسيع وطي مجموعات البيانات
   - الحفر لأسفل للوصول إلى تفاصيل إضافية
   - الانتقال إلى المستندات المصدرية
   - إضافة ملاحظات وتعليقات على بنود محددة
   - تحديث البيانات وإعادة حساب النتائج

4. **إدارة المراجعة والتدقيق**:
   - تتبع التغييرات والتعديلات على البيانات
   - توثيق ملاحظات المراجعة والتدقيق
   - إنشاء مسارات تدقيق للتغييرات
   - تعيين حالات الاعتماد والمراجعة
   - إدارة سير عمل المراجعة والاعتماد
   - توثيق إجراءات التصحيح والمتابعة

### تصدير ومشاركة التقارير
1. **تصدير التقارير بتنسيقات مختلفة**:
   - تصدير إلى ملفات Excel (XLSX، CSV)
   - تصدير إلى ملفات PDF
   - تصدير إلى ملفات XML
   - تصدير البيانات الخام للمعالجة الخارجية
   - تصدير الرسوم البيانية والمخططات
   - تخصيص عملية التصدير والمخرجات

2. **طباعة التقارير**:
   - معاينة التقرير قبل الطباعة
   - طباعة التقرير كاملاً أو أجزاء محددة منه
   - تخصيص رأس وتذييل الصفحات المطبوعة
   - حفظ إعدادات الطباعة للاستخدام المستقبلي

3. **مشاركة التقارير مع الآخرين**:
   - إرسال التقرير عبر البريد الإلكتروني
   - إضافة نص ومحتوى لرسالة البريد الإلكتروني
   - اختيار المستلمين من قائمة جهات الاتصال
   - إنشاء روابط مشاركة للتقرير مع تحديد صلاحيات الوصول
   - جدولة إرسال التقارير بشكل دوري
   - تتبع حالة مشاهدة التقارير المشتركة

4. **جدولة توزيع التقارير**:
   - إعداد جداول زمنية لإنشاء وتوزيع التقارير تلقائياً
   - تحديد المستلمين لكل جدولة
   - تكوين معايير التقرير المجدول
   - تحديد تنسيق وطريقة التسليم
   - إعداد رسائل مخصصة للتقارير المجدولة
   - مراقبة وإدارة جداول التقارير

### أنواع تقارير الإغلاق الرئيسية
1. **تقارير الإغلاق الشهري**:
   - تقرير ميزان المراجعة الشهري
   - تقرير الإيرادات والمصروفات الشهرية
   - تقرير المقبوضات والمدفوعات الشهرية
   - تقرير التسويات البنكية الشهرية
   - تقرير حركة الحسابات المتعلقة بالإغلاق
   - تقرير الذمم المدينة والدائنة نهاية الشهر
   - تقرير مقارنة الأداء مع الشهر السابق

2. **تقارير الإغلاق الربع سنوي**:
   - تقرير الميزانية العمومية الربع سنوية
   - تقرير قائمة الدخل الربع سنوية
   - تقرير التدفقات النقدية الربع سنوي
   - تقرير مقارنة الأداء الربع سنوي مع الموازنة
   - تقرير تحليل الانحرافات الربع سنوي
   - تقرير المخصصات والتسويات الربع سنوية
   - تقرير المؤشرات المالية الربع سنوي

3. **تقارير الإغلاق السنوي**:
   - تقرير الميزانية العمومية النهائية
   - تقرير قائمة الدخل السنوية
   - تقرير التدفقات النقدية السنوي
   - تقرير التغيرات في حقوق الملكية
   - تقرير الأرصدة المرحلة للسنة الجديدة
   - تقرير المخصصات والاحتياطيات السنوية
   - تقرير توزيعات الأرباح المقترحة

4. **تقارير التدقيق والمراجعة**:
   - تقرير سجل عمليات الإغلاق
   - تقرير التعديلات والتسويات
   - تقرير المخالفات والاستثناءات
   - تقرير اكتمال المستندات
   - تقرير المراجعة الضريبية
   - تقرير الالتزام بالمعايير المحاسبية
   - تقرير المراجعة الداخلية لعملية الإغلاق

5. **تقارير المطابقة والتسوية**:
   - تقرير مطابقة الحسابات البنكية
   - تقرير مطابقة حسابات العملاء والموردين
   - تقرير مطابقة الأرصدة بين الفروع
   - تقرير مطابقة الأصول والمخزون
   - تقرير تسويات نهاية الفترة
   - تقرير تسوية الضرائب والرسوم
   - تقرير مطابقة الأستاذ العام مع الدفاتر الفرعية 

   ## العمليات المتقدمة

### تحليلات البيانات المتقدمة
1. **التحليل التنبؤي والاتجاهي**:
   - تحليل اتجاهات البيانات المالية عبر فترات متعددة
   - توقع النتائج المالية المستقبلية بناءً على البيانات التاريخية
   - اكتشاف الأنماط والدورات في البيانات المالية
   - تحديد المؤشرات الرئيسية للتغيرات المالية المستقبلية
   - مقارنة التوقعات مع الأداء الفعلي
   - تعديل النماذج التنبؤية بناءً على النتائج

2. **تحليل السيناريوهات**:
   - إنشاء سيناريوهات مالية متعددة (متفائل، واقعي، متشائم)
   - مقارنة نتائج الإغلاق مع سيناريوهات مختلفة
   - تقييم تأثير التغيرات في المتغيرات المالية الرئيسية
   - اختبار حساسية المؤشرات المالية للتغيرات في العوامل المؤثرة
   - تحديد نقاط التحول والمخاطر المحتملة
   - توفير رؤى لاتخاذ القرارات الاستراتيجية

3. **تحليل المقارنات المرجعية**:
   - مقارنة نتائج الإغلاق مع مؤشرات الأداء الرئيسية
   - مقارنة الأداء مع الشركات المماثلة في القطاع
   - تحليل الانحرافات عن المعايير القياسية
   - تحديد مجالات التحسين والتطوير
   - وضع أهداف مستقبلية بناءً على المعايير القياسية
   - إنشاء لوحات متابعة لمراقبة أداء المؤشرات الرئيسية

4. **تحليل تصنيفي متعدد الأبعاد**:
   - عرض البيانات المالية من منظورات متعددة
   - تحليل البيانات حسب الفروع، المنتجات، القطاعات، الأقسام
   - استخراج معلومات تفصيلية حسب الحاجة
   - إنشاء تقاطعات تحليلية بين المتغيرات المختلفة
   - التنقل بين مستويات التفاصيل (التكبير والتصغير)
   - تحديد العلاقات والارتباطات بين المتغيرات المختلفة

### الأتمتة والجدولة
1. **أتمتة تقارير الإغلاق**:
   - إعداد تشغيل آلي لتقارير الإغلاق الدورية
   - تكوين تسلسل إنشاء التقارير المترابطة
   - إعداد معالجة آلية للبيانات قبل إنشاء التقارير
   - تكوين قواعد التحقق من صحة البيانات
   - إعداد إجراءات التصحيح الآلي للمشكلات الشائعة
   - تطبيق قوالب التقارير آلياً

2. **جدولة وتوزيع التقارير**:
   - إعداد جداول زمنية لإنشاء التقارير الدورية
   - تكوين قوائم المستلمين لكل نوع من التقارير
   - إعداد رسائل تلقائية تصاحب التقارير المرسلة
   - تحديد أولويات وتسلسل إرسال التقارير
   - إعداد إشعارات تذكيرية للمراجعة والتوقيع
   - مراقبة عمليات التوزيع وحالة المشاهدة

3. **التكامل مع نظم التنبيهات**:
   - إعداد تنبيهات آلية عند الانحرافات المهمة
   - تكوين إشعارات للتسويات والإجراءات المطلوبة
   - إعداد تنبيهات لتجاوز الحدود والمؤشرات الحرجة
   - ربط التنبيهات بمسارات العمل المناسبة
   - تكوين مستويات الأولوية للتنبيهات المختلفة
   - إعداد آليات تصعيد للمشكلات غير المعالجة

4. **إدارة سير العمل للإغلاق**:
   - تكوين تدفقات العمل لعمليات الإغلاق
   - تحديد المهام والمسؤوليات لكل مرحلة
   - إعداد شروط الانتقال بين مراحل الإغلاق
   - ربط التحققات والموافقات المطلوبة بكل مرحلة
   - متابعة آلية لحالة تقدم عملية الإغلاق
   - إنشاء تقارير متابعة لإدارة سير العمل

### تخصيص النظام والتقارير
1. **إنشاء تقارير مخصصة**:
   - تصميم هيكل تقارير جديدة
   - إضافة حقول وعناصر مخصصة
   - تكوين عمليات حسابية ومعادلات خاصة
   - إعداد قوالب عرض متعددة
   - تخصيص تنسيق وأسلوب عرض التقارير
   - حفظ وإدارة التقارير المخصصة

2. **تخصيص لوحات المعلومات**:
   - إنشاء لوحات معلومات تفاعلية للإغلاق
   - تكوين مؤشرات الأداء الرئيسية
   - تخصيص طريقة عرض الرسوم البيانية
   - إضافة عناصر تفاعلية وعوامل تصفية
   - إعداد وضع مخصص لكل مستخدم أو دور
   - ربط لوحات المعلومات بمصادر البيانات المختلفة

3. **تكوين القوالب والنماذج**:
   - إنشاء قوالب لأنواع مختلفة من تقارير الإغلاق
   - تكوين نماذج متعددة لنفس التقرير
   - إعداد قوالب حسب متطلبات الجهات الخارجية
   - تخصيص نماذج الطباعة والمشاركة
   - إدارة مكتبة القوالب والنماذج
   - مشاركة القوالب بين المستخدمين

4. **إدارة معايير التقارير**:
   - تكوين مجموعات معايير مخصصة
   - إنشاء معايير متقدمة للتصفية والفرز
   - حفظ مجموعات المعايير للاستخدام المستقبلي
   - إنشاء معايير مشتركة لمجموعات المستخدمين
   - ربط المعايير بأنواع معينة من التقارير
   - تخصيص المعايير الافتراضية لكل تقرير

### تكامل البيانات
1. **تكامل مع أنظمة خارجية**:
   - استيراد البيانات من الأنظمة المالية الخارجية
   - تصدير تقارير الإغلاق إلى أنظمة إدارة المستندات
   - ربط مع أنظمة تخطيط موارد المؤسسات الأخرى
   - التكامل مع أدوات التحليل والذكاء الأعمال
   - ربط مع أنظمة إعداد التقارير للجهات التنظيمية
   - التكامل مع أنظمة إدارة علاقات العملاء والموردين

2. **تجميع وتوحيد البيانات**:
   - تجميع بيانات الإغلاق من مصادر متعددة
   - توحيد البيانات من فروع وشركات مختلفة
   - التعامل مع تحويلات العملات المختلفة
   - معالجة تسويات التوحيد والاستبعادات
   - إدارة فروقات السياسات المحاسبية
   - توحيد العرض والتصنيف للبيانات المجمعة

3. **تصدير البيانات المتقدم**:
   - تصدير بيانات مهيكلة لاستخدامها في أنظمة أخرى
   - إنشاء ملفات تصدير بتنسيقات خاصة
   - تكوين قواعد تحويل البيانات عند التصدير
   - جدولة عمليات التصدير التلقائي
   - تضمين البيانات الوصفية في ملفات التصدير
   - إدارة نسخ وإصدارات البيانات المصدرة

4. **إدارة مراجع البيانات**:
   - ربط تقارير الإغلاق بمصادر البيانات الأصلية
   - إنشاء هيكل علاقات بين التقارير المختلفة
   - تتبع مصدر البيانات في كل جزء من التقرير
   - توفير إمكانية الوصول السريع للبيانات التفصيلية
   - توثيق مصادر البيانات والافتراضات المستخدمة
   - إدارة سلسلة المراجع بين التقارير المترابطة 

   ## مكونات طبقة التطبيق

### الكيانات (Entities)

#### ClosingReport
كيان رئيسي يمثل تقرير الإغلاق ويحتوي على:
- رقم التقرير
- نوع التقرير (شهري، ربع سنوي، سنوي)
- عنوان التقرير
- وصف التقرير
- الفترة المالية المرتبطة
- معايير التقرير
- حالة التقرير (مسودة، قيد المراجعة، معتمد)
- تاريخ الإنشاء
- تاريخ آخر تعديل
- المستخدم المنشئ
- المستخدم المعدل
- إعدادات العرض
- علاقة بالمستندات المرفقة
- علاقة بالفترة المحاسبية

#### ClosingReportTemplate
كيان يمثل قالب تقرير الإغلاق ويحتوي على:
- رقم القالب
- اسم القالب
- وصف القالب
- نوع التقرير المرتبط
- بنية التقرير
- عناصر التقرير
- معايير التقرير الافتراضية
- إعدادات العرض الافتراضية
- إمكانية المشاركة (خاص، مشترك، عام)
- تاريخ الإنشاء
- المستخدم المنشئ
- معلومات آخر تعديل

#### ClosingReportCriteria
كيان يمثل معايير تقرير الإغلاق ويحتوي على:
- رقم المعيار
- اسم مجموعة المعايير
- الفترة المالية
- نطاق التاريخ
- الفروع المحددة
- العملات المحددة
- مستوى التفصيل
- معايير المقارنة
- معايير التصفية
- معايير الفرز
- معايير التجميع
- علاقة بتقرير الإغلاق

#### ClosingReportData
كيان يمثل بيانات تقرير الإغلاق ويحتوي على:
- رقم البيانات
- رقم التقرير المرتبط
- البيانات المالية
- البيانات المحسوبة
- البيانات التحليلية
- البيانات المقارنة
- تاريخ توليد البيانات
- حالة البيانات (محدثة، قديمة)
- نسخة البيانات
- علاقة بمصادر البيانات

#### ClosingReportSection
كيان يمثل قسم من أقسام تقرير الإغلاق ويحتوي على:
- رقم القسم
- رقم التقرير المرتبط
- عنوان القسم
- نوع القسم (جدول، رسم بياني، نص)
- ترتيب القسم
- إعدادات عرض القسم
- البيانات المرتبطة بالقسم
- الملاحظات على القسم
- حالة العرض (ظاهر، مخفي)

#### ClosingReportNote
كيان يمثل ملاحظة على تقرير الإغلاق ويحتوي على:
- رقم الملاحظة
- رقم التقرير المرتبط
- نص الملاحظة
- نوع الملاحظة (عامة، خاصة ببند)
- أولوية الملاحظة
- حالة الملاحظة (جديدة، قيد المعالجة، منتهية)
- المستخدم المنشئ
- تاريخ الإنشاء
- تاريخ آخر تحديث
- علاقة ببند التقرير (إن وجد)

#### ClosingReportAttachment
كيان يمثل مرفق بتقرير الإغلاق ويحتوي على:
- رقم المرفق
- رقم التقرير المرتبط
- اسم الملف
- نوع الملف
- حجم الملف
- وصف المرفق
- تاريخ الإرفاق
- المستخدم المرفق
- رابط الملف
- نوع المرفق (مستند داعم، ملف تحليلي، غيره)

#### ClosingReportSchedule
كيان يمثل جدولة تقرير الإغلاق ويحتوي على:
- رقم الجدولة
- رقم التقرير المرتبط
- نمط التكرار
- تاريخ البدء
- تاريخ الانتهاء (اختياري)
- آخر تنفيذ
- التنفيذ القادم
- قائمة المستلمين
- إعدادات التسليم
- حالة الجدولة (نشطة، متوقفة)
- تاريخ آخر تعديل
- المستخدم المعدل

#### ClosingReportApproval
كيان يمثل اعتماد تقرير الإغلاق ويحتوي على:
- رقم الاعتماد
- رقم التقرير المرتبط
- نوع الاعتماد (إعداد، مراجعة، اعتماد نهائي)
- حالة الاعتماد (منتظر، معتمد، مرفوض)
- المستخدم المسؤول
- تاريخ الاعتماد
- ملاحظات الاعتماد
- رقم الإصدار المعتمد
- توقيع المستخدم

### الأوامر (Commands)

#### CreateClosingReportCommand
إنشاء تقرير إغلاق جديد في النظام.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لإنشاء تقارير الإغلاق
- التحقق من توفر جميع البيانات المطلوبة
- التحقق من صحة الفترة المالية المحددة
- إنشاء كيان تقرير جديد وتعيين الحالة الابتدائية
- تطبيق القالب المحدد إن وجد
- تخزين معايير التقرير
- توليد رقم فريد للتقرير
- تسجيل معلومات الإنشاء (المستخدم، التاريخ)

#### UpdateClosingReportCommand
تحديث تقرير إغلاق موجود.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لتعديل التقرير
- التحقق من وجود التقرير وحالته (لا يمكن تعديل التقارير المعتمدة نهائيًا)
- تحديث المعلومات والمعايير المطلوبة
- الحفاظ على تاريخ التغييرات في سجل المراجعة
- تحديث حالة التقرير إذا لزم الأمر
- تسجيل معلومات التعديل (المستخدم، التاريخ)

#### GenerateClosingReportDataCommand
توليد بيانات تقرير الإغلاق.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم للوصول للبيانات
- التحقق من وجود جميع مصادر البيانات المطلوبة
- استخراج البيانات المالية بناءً على معايير التقرير
- تنفيذ العمليات الحسابية والتحليلية اللازمة
- تطبيق تحويلات العملات إذا لزم الأمر
- تجميع وتنظيم البيانات حسب هيكل التقرير
- تخزين البيانات المولدة مع الإصدار والتاريخ
- تحديث حالة البيانات لتكون محدثة

#### SaveClosingReportTemplateCommand
حفظ قالب تقرير إغلاق.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لإنشاء/تعديل القوالب
- التحقق من صحة بنية القالب
- التحقق من فرادة اسم القالب
- حفظ إعدادات وبنية القالب
- تحديد خيارات المشاركة والصلاحيات
- تسجيل معلومات الإنشاء/التعديل

#### ScheduleClosingReportCommand
جدولة إنشاء وتوزيع تقرير إغلاق.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لجدولة التقارير
- التحقق من صحة نمط التكرار والتواريخ
- التحقق من وجود قائمة مستلمين صالحة
- إنشاء كيان جدولة جديد مرتبط بالتقرير
- حساب توقيت التنفيذ القادم
- تكوين إعدادات التسليم والإشعارات
- تفعيل حالة الجدولة

#### ExportClosingReportCommand
تصدير تقرير إغلاق بتنسيق محدد.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لتصدير التقارير
- التحقق من توفر البيانات اللازمة للتصدير
- التحقق من صحة تنسيق التصدير المطلوب
- تحويل بيانات التقرير إلى التنسيق المطلوب
- تطبيق قواعد التنسيق والتصميم
- إنشاء ملف التصدير (PDF، Excel، CSV، إلخ)
- تسجيل عملية التصدير في سجل الأنشطة

#### AddClosingReportNoteCommand
إضافة ملاحظة لتقرير إغلاق.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لإضافة ملاحظات
- التحقق من وجود التقرير وإمكانية إضافة ملاحظات عليه
- إنشاء كيان ملاحظة جديد
- ربط الملاحظة بالتقرير أو ببند محدد فيه
- تعيين حالة الملاحظة الابتدائية
- إشعار المستخدمين المعنيين بإضافة الملاحظة
- تسجيل معلومات إنشاء الملاحظة

#### ApproveClosingReportCommand
اعتماد تقرير إغلاق.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لاعتماد التقارير
- التحقق من وجود التقرير وحالته الحالية
- التحقق من اكتمال جميع المراجعات المطلوبة
- إنشاء كيان اعتماد جديد مرتبط بالتقرير
- تحديث حالة التقرير بناءً على نوع الاعتماد
- تسجيل توقيع المستخدم وتاريخ الاعتماد
- إشعار المستخدمين المعنيين بعملية الاعتماد 

### الاستعلامات (Queries)

#### GetClosingReportByIdQuery
استرجاع تقرير إغلاق محدد بواسطة الرقم التعريفي.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم للوصول للتقرير
- التحقق من وجود التقرير المطلوب
- استرجاع بيانات التقرير الأساسية
- استرجاع أقسام التقرير المرتبطة
- استرجاع الملاحظات والمرفقات
- استرجاع معلومات الاعتماد إن وجدت
- تطبيق تصفية البيانات حسب صلاحيات المستخدم

#### GetAvailableClosingReportsQuery
استرجاع قائمة تقارير الإغلاق المتاحة مع إمكانية التصفية.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم للوصول لقائمة التقارير
- تطبيق معايير التصفية (الفترة، النوع، الحالة)
- ترتيب النتائج حسب المعايير المحددة
- تصفية النتائج حسب صلاحيات المستخدم
- تجميع التقارير حسب التصنيف إذا طلب
- استرجاع الأعداد الإجمالية لعرض إحصائيات
- تطبيق تقسيم الصفحات للنتائج

#### GetClosingReportTemplatesQuery
استرجاع قوالب تقارير الإغلاق المتاحة.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم للوصول لقوالب التقارير
- تصفية القوالب حسب صلاحيات المستخدم
- استرجاع القوالب الخاصة بالمستخدم والقوالب العامة
- تصنيف القوالب حسب النوع أو الاستخدام
- استرجاع معلومات الاستخدام لكل قالب
- ترتيب النتائج حسب المعايير المحددة

#### GetClosingReportSchedulesQuery
استرجاع جدولة تقارير الإغلاق.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم للوصول لجداول التقارير
- تصفية الجداول حسب حالتها وتاريخ تنفيذها
- استرجاع معلومات الجدولة مع التقارير المرتبطة
- تحديد الجداول التي ستنفذ قريبًا
- استرجاع سجل تنفيذ الجداول السابقة
- تصفية النتائج حسب صلاحيات المستخدم

#### GetClosingReportHistoryQuery
استرجاع تاريخ تغييرات تقرير إغلاق.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم للوصول لتاريخ التقرير
- التحقق من وجود التقرير المطلوب
- استرجاع سجل التغييرات على التقرير
- استرجاع معلومات المستخدمين والتواريخ
- استرجاع تفاصيل التغييرات والإصدارات
- ترتيب النتائج حسب تسلسل التاريخ
- تطبيق تصفية على نوع التغييرات إذا طلب

#### GetFavoriteClosingReportsQuery
استرجاع تقارير الإغلاق المفضلة للمستخدم.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم
- استرجاع قائمة التقارير المفضلة للمستخدم الحالي
- استرجاع معلومات التقارير المرتبطة
- ترتيب النتائج حسب الاستخدام أو معايير أخرى
- استرجاع معلومات آخر استخدام لكل تقرير
- تصفية النتائج حسب الحالة إذا طلب

#### GetRecentClosingReportsQuery
استرجاع تقارير الإغلاق المستخدمة مؤخرًا.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم
- استرجاع قائمة التقارير المستخدمة مؤخرًا
- تحديد فترة "المستخدمة مؤخرًا" حسب إعدادات النظام
- ترتيب النتائج حسب تاريخ آخر استخدام
- تصفية النتائج المكررة
- استرجاع معلومات الإجراء الأخير على كل تقرير
- تصفية النتائج حسب صلاحيات المستخدم

## منطق الأعمال والتحققات

### فحص الصلاحيات
- تحقق من صلاحيات المستخدم للوصول لتقارير الإغلاق
- تحقق من صلاحيات إنشاء وتعديل التقارير
- تحقق من صلاحيات اعتماد التقارير
- تحقق من صلاحيات تصدير ومشاركة التقارير
- تطبيق تصفية النتائج حسب صلاحيات المستخدم
- تطبيق صلاحيات خاصة للتقارير الحساسة

### تحققات البيانات
- التحقق من صحة واكتمال معايير التقارير
- تحقق من اتساق البيانات في تقارير المقارنة
- تحقق من صحة تحويلات العملات في التقارير متعددة العملات
- التحقق من توازن البيانات المالية في التقارير
- التحقق من صحة التواريخ والفترات المحاسبية
- تطبيق قواعد التقريب والتنسيق حسب إعدادات النظام

### حالات خاصة
- معالجة الفترات المحاسبية المغلقة جزئياً
- معالجة البيانات التي تتجاوز حدود الفترة المحددة
- معالجة التقارير التي تتضمن بيانات من أكثر من سنة مالية
- معالجة حالات تغيير العملة الأساسية
- التعامل مع تقارير الفترات المقارنة غير المتساوية
- معالجة حالات عدم توفر بعض البيانات للفترات السابقة

### استراتيجيات تحميل البيانات
- تحميل بيانات التقارير على مراحل لتحسين الأداء
- استخدام التخزين المؤقت للنتائج المستخدمة بشكل متكرر
- تطبيق استراتيجيات تأجيل تحميل البيانات التفصيلية
- تنفيذ عمليات المعالجة الثقيلة في الخلفية
- تحميل البيانات التاريخية حسب الحاجة فقط
- تطبيق استراتيجيات تجميع البيانات المسبق لتحسين الأداء

### تكامل البيانات
- تجميع البيانات من مصادر متعددة بشكل متسق
- التحقق من اتساق التصنيفات والترميز بين المصادر المختلفة
- معالجة اختلافات السياسات المحاسبية بين الفروع
- تطبيق قواعد التوافق مع المعايير المحاسبية المعتمدة
- ضمان سلامة البيانات أثناء تبادلها بين الأنظمة المختلفة
- توحيد تنسيق البيانات المستوردة

### إدارة الأداء
- تحسين أداء استعلامات التقارير الكبيرة
- تطبيق استراتيجيات التصفية المبكرة للبيانات
- تقسيم توليد التقارير الكبيرة إلى مهام متوازية
- تطبيق فهرسة مناسبة لتحسين زمن الاستجابة
- جدولة توليد التقارير المعقدة في أوقات انخفاض الحمل
- تطبيق حدود على كمية البيانات المعروضة دفعة واحدة

### تجربة المستخدم
- تقديم ردود فعل مناسبة أثناء توليد التقارير الكبيرة
- عرض مؤشرات تقدم واضحة للعمليات طويلة الأمد
- حفظ تفضيلات المستخدم لتحسين تجربة الاستخدام
- تقديم خيارات مناسبة لتخصيص عرض التقارير
- توفير رسائل خطأ واضحة ومفيدة
- تقديم اقتراحات ذكية بناءً على تاريخ استخدام المستخدم

## اختصارات لوحة المفاتيح وأزرار الشاشة السريعة

### اختصارات لوحة المفاتيح العامة
- **F1**: عرض المساعدة الخاصة بشاشة تقارير الإغلاق
- **F2**: فتح نافذة البحث عن تقرير
- **F3**: تحديث البيانات المعروضة
- **F5**: إعادة توليد التقرير الحالي
- **F6**: فتح نافذة معايير التقرير
- **F8**: حفظ التقرير الحالي
- **F10**: تصدير التقرير الحالي
- **F11**: طباعة التقرير الحالي
- **F12**: إغلاق نافذة التقرير الحالية
- **Ctrl+N**: إنشاء تقرير جديد
- **Ctrl+O**: فتح تقرير محفوظ
- **Ctrl+S**: حفظ التقرير الحالي
- **Ctrl+P**: طباعة التقرير الحالي
- **Ctrl+E**: تصدير التقرير الحالي
- **Ctrl+B**: إضافة/إزالة التقرير من المفضلة
- **Ctrl+F**: البحث في محتوى التقرير
- **Ctrl+G**: الانتقال إلى قسم محدد في التقرير
- **Ctrl+I**: عرض معلومات التقرير
- **Ctrl+H**: عرض تاريخ التغييرات
- **Ctrl+R**: تحديث بيانات التقرير

### اختصارات التنقل في التقرير
- **الأسهم**: التنقل بين خلايا البيانات
- **Page Up/Down**: التنقل بين صفحات التقرير
- **Home**: الانتقال إلى بداية التقرير
- **End**: الانتقال إلى نهاية التقرير
- **Tab**: الانتقال بين حقول الإدخال
- **Ctrl+Home**: الانتقال إلى الصفحة الأولى
- **Ctrl+End**: الانتقال إلى الصفحة الأخيرة
- **Alt+Arrow Left/Right**: التنقل بين أقسام التقرير
- **Ctrl+Tab**: التنقل بين التقارير المفتوحة
- **Ctrl+Shift+Tab**: التنقل بين التقارير المفتوحة (عكسي)

### اختصارات عرض التقرير
- **Ctrl++**: تكبير العرض
- **Ctrl+-**: تصغير العرض
- **Ctrl+0**: إعادة ضبط حجم العرض
- **Alt+1-9**: تبديل بين تخطيطات العرض المختلفة
- **Alt+G**: تبديل عرض الرسوم البيانية
- **Alt+T**: تبديل عرض الجداول
- **Alt+C**: تبديل عرض الملخصات
- **Alt+D**: تبديل وضع العرض المفصل/الملخص
- **Alt+F**: توسيع/طي جميع المجموعات

### أزرار الوصول السريع في شريط الأدوات
- **زر إنشاء تقرير جديد**: إنشاء تقرير جديد من نوع محدد
- **زر قوائم التقارير المفضلة**: عرض قائمة التقارير المفضلة
- **زر التقارير الأخيرة**: عرض قائمة التقارير المستخدمة مؤخراً
- **زر قوالب التقارير**: عرض وتطبيق قوالب التقارير المحفوظة
- **زر حفظ المعايير**: حفظ معايير التقرير الحالية للاستخدام لاحقاً
- **زر إعدادات العرض**: تخصيص إعدادات عرض التقرير
- **زر تغيير نمط العرض**: التبديل بين أنماط العرض المختلفة
- **زر جدولة التقرير**: إعداد جدولة إنشاء وتوزيع التقرير
- **زر مشاركة التقرير**: مشاركة التقرير مع مستخدمين آخرين
- **زر التاريخ والإصدارات**: عرض تاريخ التغييرات والإصدارات

### أزرار الوظائف المتخصصة
- **زر المقارنة**: تنشيط وضع مقارنة الفترات
- **زر التحليل**: الوصول لأدوات التحليل المتقدمة
- **زر المراجعة والتدقيق**: فتح أدوات المراجعة والتدقيق
- **زر الملاحظات والتعليقات**: إدارة ملاحظات وتعليقات التقرير
- **زر التنبيهات**: إعداد وإدارة تنبيهات مرتبطة بالتقرير
- **زر التصدير المهيكل**: تصدير البيانات بتنسيقات مهيكلة
- **زر معالجة البيانات**: تطبيق عمليات معالجة خاصة على البيانات
- **زر الاعتماد والتوقيع**: إرسال التقرير للاعتماد أو توقيعه
- **زر الإصدارات**: إدارة إصدارات متعددة من التقرير
- **زر الأمن والصلاحيات**: إدارة صلاحيات الوصول للتقرير
- **زر الاستخدام الذكي**: الوصول للميزات الذكية والتعلم الآلي

### أزرار مؤشرات الحالة
- **مؤشر حالة البيانات**: يوضح حالة تحديث البيانات
- **مؤشر حالة الاعتماد**: يوضح حالة اعتماد التقرير
- **مؤشر المراجعة**: يوضح حالة مراجعة التقرير
- **مؤشر الوصول**: يوضح صلاحيات المستخدم للتقرير
- **مؤشر المشاركة**: يوضح عدد المستخدمين المشارك معهم التقرير
- **مؤشر الجدولة**: يوضح حالة جدولة التقرير
- **مؤشر الإشعارات**: يوضح وجود إشعارات مرتبطة بالتقرير 
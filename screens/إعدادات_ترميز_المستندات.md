# شاشة إعدادات ترميز المستندات (Document Numbering Settings)

## نظرة عامة
شاشة إعدادات ترميز المستندات هي واحدة من شاشات الإعدادات الأساسية في نظام الأونكس برو ERP، وتُستخدم لتعريف وإدارة قواعد ترميز المستندات والوثائق في النظام. تتيح هذه الشاشة للمستخدمين إنشاء وتعديل أنماط الترميز، وتحديد قواعد التسمية التلقائية، وتكوين المتغيرات والمكونات التي تشكل رموز المستندات المختلفة.

تُعتبر إعدادات ترميز المستندات عنصراً حيوياً في تنظيم وإدارة الوثائق والمستندات داخل النظام، حيث تساعد على تسهيل عمليات الفهرسة والبحث والاسترجاع. من خلال هذه الشاشة، يمكن للمستخدمين تصميم أنظمة ترميز ذكية تعكس الهيكل التنظيمي للمؤسسة وتراعي متطلبات الإدارات المختلفة، مما يؤدي إلى تحسين كفاءة العمل وتسهيل تتبع المستندات والتدقيق.

## الوظائف الرئيسية

### إدارة أنماط الترميز
1. **إضافة نمط ترميز جديد**:
   - إدخال المعلومات الأساسية للنمط (الرمز، الاسم، النوع)
   - تصميم بنية نمط الترميز باستخدام المتغيرات والنصوص الثابتة
   - تحديد قواعد التوليد والتحقق من الصحة
   - تعيين قواعد التعديل والاستثناءات
   - اختبار النمط للتأكد من عمله بشكل صحيح
   - تطبيق النمط على أنواع المستندات المطلوبة

2. **تعديل أنماط الترميز الموجودة**:
   - تحديث معلومات النمط
   - تعديل بنية نمط الترميز
   - تغيير قواعد التوليد والتحقق
   - تحديث قواعد التعديل والاستثناءات
   - اختبار التغييرات قبل تطبيقها
   - تطبيق التغييرات مع خيار التعامل مع المستندات الموجودة

3. **تفعيل وتعطيل أنماط الترميز**:
   - تغيير حالة النمط بين نشط ومعطل
   - التحقق من عدم وجود مستندات قيد الإنشاء تستخدم النمط قبل التعطيل
   - حفظ تاريخ وسبب التعطيل
   - إمكانية تحديد تاريخ مستقبلي للتعطيل
   - تعيين نمط بديل للمستندات الجديدة
   - إعادة تفعيل نمط معطل

4. **نسخ أنماط الترميز**:
   - إنشاء نسخة من نمط موجود كأساس لنمط جديد
   - تخصيص النسخة حسب الاحتياجات الجديدة
   - حفظ النمط الجديد برمز مختلف
   - تطبيق النمط الجديد على مستندات محددة
   - نسخ الإعدادات والقواعد من النمط الأصلي

5. **حذف أنماط الترميز**:
   - حذف نمط غير مستخدم
   - التحقق من عدم ارتباط النمط بأي مستندات
   - خيار أرشفة النمط بدلاً من حذفه نهائياً
   - تسجيل بيانات الحذف (المستخدم، التاريخ، السبب)
   - تحويل المستندات المرتبطة إلى نمط آخر قبل الحذف

6. **استيراد وتصدير أنماط الترميز**:
   - استيراد أنماط الترميز من ملف خارجي (Excel، XML، JSON)
   - دعم صيغ استيراد مختلفة (قياسية، مخصصة)
   - تصدير أنماط الترميز الحالية إلى ملف
   - التحقق من تكامل البيانات المستوردة
   - دمج الأنماط المستوردة مع الموجودة
   - استيراد أنماط من قوالب جاهزة

7. **اختبار وتدقيق أنماط الترميز**:
   - اختبار توليد الرموز باستخدام قيم متنوعة
   - تحقق من صحة الرموز المولدة
   - اختبار الحالات الاستثنائية والحدية
   - تدقيق طول وتنسيق الرموز المولدة
   - التحقق من تفرد الرموز المولدة
   - تحليل أداء وكفاءة توليد الرموز

### إدارة المتغيرات والدوال
1. **إدارة متغيرات الترميز**:
   - تعريف متغيرات جديدة للاستخدام في أنماط الترميز
   - تعديل خصائص المتغيرات الموجودة
   - تحديد القيم الافتراضية للمتغيرات
   - ضبط شروط استخدام المتغيرات
   - تكوين آلية جلب قيم المتغيرات
   - تعريف العلاقات بين المتغيرات

2. **تكوين الدوال المخصصة**:
   - إنشاء دوال مخصصة لمعالجة متغيرات الترميز
   - تعديل سلوك الدوال الموجودة
   - تحديد معايير وقواعد تطبيق الدوال
   - اختبار الدوال باستخدام قيم مختلفة
   - توثيق الدوال وطريقة استخدامها
   - تحديد الصلاحيات لاستخدام الدوال المختلفة

3. **إدارة قوالب الترميز**:
   - إنشاء قوالب ترميز جاهزة للاستخدام السريع
   - تحديث القوالب الموجودة
   - تصنيف القوالب حسب نوع المستند أو المجال
   - مشاركة القوالب بين المستخدمين
   - استيراد وتصدير القوالب
   - إدارة إصدارات القوالب

### إدارة مجموعات الترميز
1. **إنشاء مجموعات الترميز**:
   - تعريف مجموعات منطقية لأنماط الترميز
   - تحديد الخصائص المشتركة للمجموعة
   - تكوين قواعد التصميم الموحدة للمجموعة
   - تعيين متغيرات إلزامية للمجموعة
   - تحديد صلاحيات إدارة المجموعة
   - وضع قواعد ومعايير لتوليد الرموز ضمن المجموعة

2. **إدارة الأنماط ضمن المجموعات**:
   - إضافة أنماط ترميز إلى المجموعة
   - نقل الأنماط بين المجموعات
   - تطبيق التغييرات على جميع أنماط المجموعة
   - تحديث قواعد التصميم للمجموعة بأكملها
   - إعداد تقارير عن مجموعات الترميز
   - تطبيق سياسات موحدة على مجموعة الترميز

### إدارة الصلاحيات والتحكم
1. **إدارة صلاحيات الترميز**:
   - تحديد المستخدمين المصرح لهم بإنشاء أنماط ترميز جديدة
   - ضبط صلاحيات تعديل الأنماط الموجودة
   - تعيين صلاحيات تعطيل أو حذف الأنماط
   - تحديد صلاحيات التعديل اليدوي للرموز المولدة
   - إدارة صلاحيات استيراد وتصدير الأنماط
   - تكوين دور مشرف الترميز (Numbering Administrator)

2. **تدقيق ومراقبة الترميز**:
   - تسجيل جميع التغييرات على أنماط الترميز
   - متابعة التعديلات اليدوية للرموز المولدة
   - إنشاء تقارير مفصلة عن نشاط الترميز
   - تدقيق امتثال الرموز المولدة للأنماط المحددة
   - كشف ومعالجة التضاربات والتكرارات
   - إعداد سجل تدقيق كامل للتغييرات

### التكامل مع النظام
1. **التكامل مع أنواع المستندات**:
   - ربط أنماط الترميز بأنواع المستندات المختلفة
   - تخصيص نمط ترميز لكل نوع مستند
   - تكوين قواعد اختيار النمط المناسب حسب خصائص المستند
   - معالجة العلاقات بين المستندات المترابطة
   - إدارة تسلسل ترميز المستندات ذات العلاقة
   - إدارة سلوك الترميز عند نسخ أو تكرار المستندات

2. **التكامل مع الوحدات الأخرى**:
   - الربط مع وحدة إدارة المستندات
   - التكامل مع نظام الأرشفة والحفظ
   - الربط مع نظام تدفق العمل والموافقات
   - التكامل مع نظام البحث واسترجاع المعلومات
   - الربط مع وحدة التقارير والتحليلات
   - التكامل مع نظام إدارة البيانات الرئيسية

3. **التكامل مع الأنظمة الخارجية**:
   - استيراد وتصدير أنماط الترميز من وإلى أنظمة خارجية
   - توافق الرموز المولدة مع المعايير الخارجية
   - التعامل مع الرموز الواردة من أنظمة خارجية
   - تخطيط وتحويل الرموز بين الأنظمة المختلفة
   - إدارة التزامن بين نظم الترميز المختلفة
   - دعم معايير الترميز العالمية

## العمليات المتقدمة

### تصميم أنماط ترميز متقدمة
- **استخدام تعبيرات منطقية**:
  - تضمين تعبيرات شرطية في نمط الترميز
  - ترميز ديناميكي يتغير حسب خصائص المستند
  - استخدام عوامل المقارنة والعمليات المنطقية
  - تطبيق قواعد اختيار متغيرات مختلفة حسب الشروط
  - بناء تعبيرات معقدة لتلبية متطلبات ترميز متقدمة

- **ترميز متعدد المستويات**:
  - تصميم أنماط ترميز هرمية
  - ربط مستويات الترميز بالهيكل التنظيمي
  - تعريف علاقات الوراثة بين أنماط الترميز
  - إنشاء قواعد توليد مختلفة لكل مستوى
  - معالجة العلاقات بين المستويات المختلفة

- **ترميز متعدد اللغات**:
  - دعم لغات متعددة في نفس نمط الترميز
  - قواعد اختيار اللغة المناسبة للترميز
  - التعامل مع حالات خاصة للغات المختلفة
  - تعريف قوالب ترجمة للمكونات النصية
  - ضمان اتساق الترميز عبر اللغات المختلفة

- **أنماط الترميز الذكية**:
  - تصميم أنماط ترميز تتكيف مع سياق الاستخدام
  - دعم التعلم والتحسين التدريجي لأنماط الترميز
  - استخدام البيانات التاريخية لتحسين قواعد الترميز
  - تطوير أنماط ترميز تتنبأ باحتياجات المستخدمين
  - تكامل تقنيات معالجة اللغة الطبيعية لتحسين الترميز

### إدارة حالات خاصة للترميز
- **معالجة التسلسلات المفقودة**:
  - آليات اكتشاف الفجوات في تسلسلات الترميز
  - استراتيجيات استعادة التسلسلات المفقودة
  - توليد تقارير عن الأرقام المفقودة ومتابعتها
  - أدوات تحليل أسباب فقدان تسلسلات الترميز
  - معالجة حالات الإلغاء والحذف في التسلسلات

- **التعامل مع تغييرات الهيكل التنظيمي**:
  - تحديث أنماط الترميز عند تغيير الهيكل التنظيمي
  - إعادة تخطيط المتغيرات التنظيمية في أنماط الترميز
  - معالجة المستندات القديمة بعد تغيير الهيكل
  - إدارة فترات انتقالية لتطبيق أنماط الترميز الجديدة
  - الحفاظ على سلامة البيانات التاريخية بعد التغيير

- **إدارة ترميز المستندات المستوردة**:
  - قواعد التعامل مع ترميز المستندات من أنظمة خارجية
  - آليات تخطيط وتحويل الرموز الخارجية إلى نظام الترميز الداخلي
  - معالجة التكرار والتضارب في الرموز المستوردة
  - حفظ العلاقة بين الرموز الأصلية والرموز المولدة
  - أدوات تعقب وتتبع المستندات المستوردة

- **إدارة ترميز النسخ والمسودات**:
  - قواعد ترميز النسخ المتعددة من نفس المستند
  - آليات ترميز مسودات المستندات
  - العلاقة بين ترميز المسودة والمستند النهائي
  - معالجة ترميز المستندات المؤقتة والمؤرشفة
  - قواعد ترميز التعديلات والإصدارات المتتالية

### استراتيجيات أمان الترميز
- **منع التلاعب والتزوير**:
  - آليات حماية الرموز من التلاعب
  - استخدام تقنيات التشفير لتأمين الرموز
  - أنظمة التحقق من صحة وسلامة الرموز
  - تضمين أرقام تحقق (Check Digits) في الرموز
  - سجلات تدقيق غير قابلة للتعديل لجميع الرموز المولدة

- **سياسات أمن الترميز**:
  - تحديد استراتيجيات التعامل مع تسرب الرموز
  - إجراءات التعامل مع محاولات الاستخدام غير المصرح به
  - سياسات إبطال وتجديد الرموز المخترقة
  - حماية معلومات خوارزميات وأنماط الترميز
  - التحقق الدوري من سلامة نظام الترميز

- **التشفير والتوقيع الرقمي**:
  - دمج تقنيات التوقيع الرقمي مع الرموز المولدة
  - استخدام الرموز كجزء من بنية المفتاح العمومي
  - تشفير عناصر معينة من نمط الترميز
  - آليات التحقق من الرموز الموقعة رقمياً
  - تطبيق سياسات إدارة المفاتيح على رموز المستندات

### أداء وتحسين نظام الترميز
- **تحسين أداء توليد الرموز**:
  - تقنيات تخزين مؤقت للرموز المتكررة
  - تحسين خوارزميات توليد الرموز لزيادة السرعة
  - استراتيجيات توزيع عبء توليد الرموز
  - تقليل الاعتماد على موارد قاعدة البيانات
  - قياس وتحسين وقت الاستجابة لتوليد الرموز

- **إدارة النمو والتوسع**:
  - استراتيجيات للتعامل مع الزيادة المستمرة في حجم المستندات
  - تصميم أنماط ترميز قابلة للتوسع
  - التعامل مع نفاد نطاقات الترميز
  - خطط التحول والترحيل لأنظمة ترميز جديدة
  - إدارة دورة حياة أنماط الترميز

- **معالجة التزامن والتنافس**:
  - حل مشكلات التنافس عند توليد الرموز المتزامنة
  - استراتيجيات قفل وتحرير نطاقات الترميز
  - آليات معالجة طلبات الترميز المتزامنة
  - استراتيجيات التخصيص المسبق للرموز
  - تقنيات الاسترداد من أخطاء التزامن

## مكونات واجهة المستخدم

### القسم العلوي (إدارة أنماط الترميز)
- **شريط العنوان**: يعرض عنوان الشاشة "إعدادات ترميز المستندات" مع أيقونة توضيحية
- **شريط الأدوات الرئيسي**: يحتوي على أزرار للوظائف الأساسية مثل:
  - زر إضافة نمط ترميز جديد (أيقونة +)
  - زر تعديل النمط المحدد (أيقونة قلم)
  - زر حذف النمط (أيقونة سلة مهملات)
  - زر تحديث البيانات (أيقونة تحديث)
  - زر استيراد أنماط الترميز (أيقونة استيراد)
  - زر تصدير أنماط الترميز (أيقونة تصدير)
  - زر المساعدة (أيقونة علامة استفهام)
- **شريط البحث**: يتيح البحث السريع عن نمط ترميز محدد حسب الرمز أو الوصف
- **عوامل التصفية**: خيارات لتصفية قائمة أنماط الترميز (الكل، النشطة، المعطلة، حسب نوع المستند)
- **مؤشر الحالة**: رموز ملونة توضح حالة أنماط الترميز (نشط، معطل، قيد التطوير)

### قائمة أنماط الترميز
- **جدول أنماط الترميز المعرفة**:
  - رمز النمط (INV-PAT، PO-PAT، JE-PAT، إلخ)
  - اسم النمط
  - نوع المستند المرتبط
  - مثال للترميز الناتج
  - عدد المتغيرات المستخدمة
  - عدد المستندات المرتبطة
  - حالة النمط (نشط/معطل)
  - آخر تحديث للنمط
- **شريط التمرير**: للتنقل في قائمة أنماط الترميز
- **شريط الحالة**: يعرض إجمالي عدد الأنماط، عدد الأنماط النشطة، تاريخ آخر تحديث للقائمة

### تبويبات تفاصيل نمط الترميز
تنقسم منطقة تفاصيل نمط الترميز إلى عدة تبويبات:

#### تبويب المعلومات الأساسية
- **رمز النمط**: الرمز الفريد لنمط الترميز
- **اسم النمط بالعربية**: الاسم الكامل للنمط باللغة العربية
- **اسم النمط بالإنجليزية**: الاسم الكامل للنمط باللغة الإنجليزية
- **نوع المستند المرتبط**: نوع المستند الذي يستخدم هذا النمط
- **المجموعة**: مجموعة أنماط الترميز التي ينتمي إليها النمط
- **وصف النمط**: وصف تفصيلي لاستخدام النمط
- **حالة النمط**: نشط أو معطل
- **مستخدم في الشاشات**: قائمة الشاشات التي تستخدم هذا النمط
- **ملاحظات**: حقل لإضافة ملاحظات إضافية حول النمط

#### تبويب تصميم نمط الترميز
- **محرر نمط الترميز**: مساحة لتصميم نمط الترميز باستخدام:
  - المكونات الثابتة (نصوص وفواصل)
  - المتغيرات (رموز تُستبدل بقيم فعلية)
  - وظائف ودوال خاصة
- **المتغيرات المتاحة**: قائمة بالمتغيرات التي يمكن استخدامها:
  - متغيرات النظام (التاريخ، الوقت، المستخدم)
  - متغيرات المؤسسة (الشركة، الفرع، الإدارة)
  - متغيرات المستند (نوع المستند، الحالة، العملة)
  - متغيرات العميل/المورد (رمز العميل، فئة العميل)
  - متغيرات السنة المالية (رمز السنة، الفترة)
- **الدوال المتاحة**: دوال معالجة النصوص والأرقام:
  - تنسيق النصوص (تغيير الحالة، اقتطاع جزء من النص)
  - تنسيق الأرقام (إكمال بأصفار، تحويل إلى حروف)
  - تنسيق التواريخ (تنسيقات مختلفة للتاريخ)
- **معاينة نمط الترميز**: عرض مباشر لناتج الترميز مع أمثلة
- **اختبار النمط**: إمكانية تجربة النمط باستخدام قيم مختلفة
- **لوحة تحقق الصحة**: تحقق من صحة النمط ويظهر الأخطاء إن وجدت

#### تبويب قواعد الترميز
- **قواعد التوليد التلقائي**:
  - متى يتم توليد الرمز (إنشاء المستند، حفظ المستند، اعتماد المستند)
  - شروط خاصة لتوليد الرمز
- **قواعد التحقق من الصحة**:
  - التحقق من تفرد الرمز
  - التحقق من طول الرمز (الحد الأدنى والأقصى)
  - التحقق من تنسيق الرمز (حروف، أرقام، رموز خاصة)
  - التحقق من قواعد مخصصة
- **قواعد التعديل**:
  - السماح بالتعديل اليدوي (نعم/لا)
  - المستخدمون المصرح لهم بالتعديل
  - حالات المستند التي يمكن تعديل الرمز فيها
  - حفظ تاريخ التعديلات على الرموز

#### تبويب الاستثناءات والحالات الخاصة
- **قواعد الاستثناءات**:
  - حالات استثنائية في توليد الرموز
  - رموز خاصة لمستندات معينة
  - تخصيص نمط الترميز حسب ظروف محددة
- **معالجة الحالات الخاصة**:
  - التعامل مع المستندات المؤقتة
  - التعامل مع النسخ والتكرار
  - التعامل مع المستندات الملغاة
  - التعامل مع مستندات التصحيح

#### تبويب المستندات المرتبطة
- **جدول المستندات المرتبطة**:
  - نوع المستند
  - اسم المستند
  - عدد المستندات التي تستخدم هذا النمط
  - الشاشات المرتبطة
  - تاريخ آخر استخدام
- **إحصاءات الاستخدام**:
  - عدد المستندات المنشأة باستخدام النمط
  - معدل استخدام النمط
  - أكثر المستخدمين استخداماً للنمط

### قسم إعدادات المجموعات
- **مجموعات أنماط الترميز**:
  - اسم المجموعة
  - وصف المجموعة
  - الأنماط المنتمية للمجموعة
  - الإعدادات المشتركة للمجموعة
- **قواعد التصميم المشتركة**:
  - بادئات موحدة للمجموعة
  - لواحق موحدة للمجموعة
  - متغيرات إلزامية للمجموعة
- **إدارة المجموعات**:
  - إضافة مجموعة جديدة
  - تعديل مجموعة
  - حذف مجموعة
  - نقل أنماط ترميز بين المجموعات

### قسم الإعدادات المتقدمة
- **قوالب أنماط الترميز الجاهزة**:
  - قوالب نمطية للاستخدام السريع
  - استيراد قوالب من مكتبة النظام
  - حفظ النمط الحالي كقالب
- **توليد الرموز المخصصة**:
  - كتابة شيفرات برمجية مخصصة لتوليد الرموز
  - استخدام لغات البرمجة النصية
  - ربط دوال خارجية لتوليد الرموز
- **إعدادات التحسين والأداء**:
  - تخزين مؤقت للرموز المولدة حديثاً
  - معالجة التوليد المتزامن للرموز
  - استراتيجيات تحسين أداء توليد الرموز 

## مكونات طبقة التطبيق

### الكيانات (Entities)

#### DocumentNumberingPattern
كيان رئيسي يمثل نمط ترميز المستندات ويحتوي على:
- رمز النمط (Code)
- اسم النمط بالعربية (NameAR)
- اسم النمط بالإنجليزية (NameEN)
- نوع المستند المرتبط (DocumentType)
- مجموعة النمط (PatternGroup)
- قالب النمط (PatternTemplate)
- الحالة (Status)
- وصف النمط (Description)
- معلومات الإنشاء والتعديل (CreatedBy, CreatedOn, ModifiedBy, ModifiedOn)
- ملاحظات (Notes)

#### PatternVariable
كيان يمثل متغير يستخدم في أنماط الترميز:
- معرف المتغير (ID)
- رمز المتغير (Code)
- اسم المتغير (Name)
- نوع المتغير (VariableType)
- وصف المتغير (Description)
- صيغة القيمة (ValueFormat)
- قيمة افتراضية (DefaultValue)
- مصدر البيانات (DataSource)
- شروط الاستخدام (UsageConditions)

#### PatternFunction
كيان يمثل دالة تستخدم في معالجة متغيرات الترميز:
- معرف الدالة (ID)
- اسم الدالة (Name)
- وصف الدالة (Description)
- نوع الدالة (FunctionType)
- المعلمات (Parameters)
- نوع المخرجات (ReturnType)
- الشيفرة البرمجية (Implementation)
- حالة الدالة (Status)

#### DocumentNumberingRule
كيان يمثل قاعدة من قواعد الترميز:
- معرف القاعدة (ID)
- رمز النمط المرتبط (PatternCode)
- نوع القاعدة (RuleType)
- شرط تطبيق القاعدة (Condition)
- أولوية القاعدة (Priority)
- إجراء القاعدة (Action)
- حالة القاعدة (Status)

#### PatternComponent
كيان يمثل مكون من مكونات نمط الترميز:
- معرف المكون (ID)
- رمز النمط المرتبط (PatternCode)
- نوع المكون (ComponentType): ثابت، متغير، دالة
- ترتيب المكون (Order)
- قيمة المكون (Value)
- إلزامي (IsRequired)
- خصائص إضافية (Properties)

#### PatternGroup
كيان يمثل مجموعة من أنماط الترميز:
- رمز المجموعة (Code)
- اسم المجموعة (Name)
- وصف المجموعة (Description)
- الإعدادات المشتركة (SharedSettings)
- قواعد التصميم المشتركة (DesignRules)
- حالة المجموعة (Status)

#### DocumentNumberingLog
كيان يسجل عمليات توليد واستخدام الرموز:
- معرف السجل (ID)
- الرمز المولد (GeneratedCode)
- رمز النمط المستخدم (PatternCode)
- نوع المستند (DocumentType)
- معرف المستند (DocumentID)
- تاريخ التوليد (GenerationDate)
- المستخدم (UserID)
- معلومات إضافية (AdditionalInfo)

#### PatternTemplate
كيان يمثل قالب نمط ترميز جاهز للاستخدام:
- معرف القالب (ID)
- اسم القالب (Name)
- وصف القالب (Description)
- محتوى القالب (Content)
- نوع المستند المرتبط (DocumentType)
- فئة القالب (Category)
- معلومات الإنشاء والتعديل (CreatedBy, CreatedOn, ModifiedBy, ModifiedOn)

### الأوامر (Commands)

#### CreateDocumentNumberingPatternCommand
إنشاء نمط ترميز مستندات جديد في النظام.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لإنشاء أنماط ترميز
- التحقق من تفرد رمز النمط
- التحقق من وجود نوع المستند المرتبط
- التأكد من صحة قالب النمط ومكوناته
- التحقق من توافق المتغيرات والدوال المستخدمة
- تسجيل معلومات الإنشاء (المستخدم، التاريخ)
- إنشاء مكونات النمط وفقاً للقالب المحدد
- اختبار النمط للتأكد من قدرته على توليد رموز صحيحة
- إصدار حدث إنشاء نمط ترميز جديد

#### UpdateDocumentNumberingPatternCommand
تحديث نمط ترميز موجود.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لتعديل أنماط الترميز
- التحقق من وجود النمط المراد تحديثه
- التأكد من صحة البيانات المدخلة
- تحديث مكونات النمط وقواعده
- التحقق من عدم تأثير التغييرات على المستندات الموجودة
- تسجيل التغييرات في سجل المراجعة
- اختبار النمط بعد التعديل
- تحديث معلومات التعديل (المستخدم، التاريخ)
- إصدار حدث تحديث نمط ترميز

#### DisableDocumentNumberingPatternCommand
تعطيل نمط ترميز.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لتعطيل أنماط الترميز
- التحقق من وجود النمط المراد تعطيله
- التأكد من عدم استخدام النمط في مستندات قيد الإنشاء
- تحديد نمط بديل للمستندات الجديدة
- تسجيل سبب وتاريخ التعطيل
- تغيير حالة النمط إلى "معطل"
- إصدار حدث تعطيل نمط ترميز
- إشعار المستخدمين المعنيين بتعطيل النمط

#### CopyDocumentNumberingPatternCommand
نسخ نمط ترميز موجود كأساس لنمط جديد.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لإنشاء أنماط ترميز
- التحقق من وجود النمط المراد نسخه
- إنشاء نسخة من النمط برمز جديد
- نسخ جميع مكونات وقواعد النمط الأصلي
- تعديل معلومات النسخة (الاسم، الوصف)
- تعيين حالة النسخة إلى "قيد التطوير"
- تسجيل معلومات الإنشاء للنسخة الجديدة
- الإشارة إلى النمط الأصلي في بيانات النسخة
- إصدار حدث نسخ نمط ترميز

#### DeleteDocumentNumberingPatternCommand
حذف نمط ترميز.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لحذف أنماط الترميز
- التحقق من وجود النمط المراد حذفه
- التأكد من عدم استخدام النمط في أي مستندات
- تسجيل سبب وتاريخ الحذف
- حذف مكونات وقواعد النمط
- تحديث سجل المراجعة
- إصدار حدث حذف نمط ترميز
- تنظيف أي مراجع للنمط المحذوف

#### AddPatternVariableCommand
إضافة متغير جديد يمكن استخدامه في أنماط الترميز.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لإدارة متغيرات الترميز
- التحقق من تفرد رمز المتغير
- التأكد من صحة تكوين المتغير
- تحديد مصدر بيانات المتغير بشكل صحيح
- تسجيل معلومات إنشاء المتغير
- تحديد أنماط الترميز التي يمكن أن تستخدم المتغير
- اختبار استرجاع قيمة المتغير
- إصدار حدث إضافة متغير ترميز جديد

#### AddPatternFunctionCommand
إضافة دالة جديدة يمكن استخدامها في أنماط الترميز.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لإدارة دوال الترميز
- التحقق من تفرد اسم الدالة
- التأكد من صحة تنفيذ الدالة وسلامتها
- تحديد معلمات الدالة ونوع المخرجات
- تسجيل معلومات إنشاء الدالة
- اختبار تنفيذ الدالة باستخدام قيم مختلفة
- تحديد صلاحيات استخدام الدالة
- إصدار حدث إضافة دالة ترميز جديدة

#### TestDocumentNumberingPatternCommand
اختبار نمط ترميز وتوليد أمثلة للرموز.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لاختبار أنماط الترميز
- التحقق من وجود النمط المراد اختباره
- توليد رموز تجريبية باستخدام النمط
- اختبار النمط بقيم مختلفة للمتغيرات
- التحقق من تفرد الرموز المولدة
- التحقق من مطابقة الرموز لمتطلبات التنسيق
- تسجيل نتائج الاختبار
- إرجاع أمثلة للرموز المولدة وتقرير الاختبار

#### CreatePatternGroupCommand
إنشاء مجموعة جديدة لأنماط الترميز.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لإدارة مجموعات الترميز
- التحقق من تفرد رمز المجموعة
- تحديد الإعدادات المشتركة للمجموعة
- تكوين قواعد التصميم المشتركة
- تسجيل معلومات إنشاء المجموعة
- إمكانية إضافة أنماط موجودة للمجموعة
- تعيين صلاحيات إدارة المجموعة
- إصدار حدث إنشاء مجموعة ترميز جديدة

#### GenerateDocumentNumberCommand
توليد رمز جديد لمستند باستخدام نمط ترميز محدد.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم لتوليد رموز المستندات
- التحقق من وجود النمط المطلوب واستخدامه
- التأكد من صحة معلومات المستند
- استبدال المتغيرات بقيمها الفعلية
- تطبيق الدوال على المتغيرات حسب الحاجة
- التحقق من تفرد الرمز المولد
- تسجيل الرمز المولد في سجل الترميز
- تخزين المعلومات المستخدمة في التوليد
- إرجاع الرمز المولد للمستند
- إصدار حدث توليد رمز مستند جديد

### الاستعلامات (Queries)

#### GetDocumentNumberingPatternsQuery
استرجاع قائمة أنماط ترميز المستندات المعرفة في النظام.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم للوصول لمعلومات أنماط الترميز
- دعم تصفية الأنماط حسب الحالة (الكل، النشطة، المعطلة)
- دعم تصفية الأنماط حسب نوع المستند أو المجموعة
- دعم البحث حسب الرمز أو الاسم
- دعم الفرز حسب معايير مختلفة
- استرجاع معلومات أساسية عن كل نمط
- دعم الصفحات لتحسين الأداء مع قوائم الأنماط الكبيرة
- تطبيق فلترة حسب صلاحيات المستخدم

#### GetDocumentNumberingPatternByCodeQuery
استرجاع تفاصيل نمط ترميز محدد برمزه.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم للوصول لمعلومات النمط
- التحقق من وجود النمط بالرمز المحدد
- استرجاع معلومات النمط كاملة
- استرجاع مكونات النمط وقواعده
- استرجاع المتغيرات والدوال المستخدمة في النمط
- استرجاع إحصاءات استخدام النمط
- استرجاع تاريخ التغييرات على النمط
- توفير أمثلة للرموز المولدة باستخدام النمط

#### GetDocumentNumberingPatternsByDocumentTypeQuery
استرجاع أنماط الترميز المرتبطة بنوع مستند محدد.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم للوصول لمعلومات أنماط الترميز
- التحقق من وجود نوع المستند المحدد
- استرجاع الأنماط النشطة المرتبطة بنوع المستند
- ترتيب الأنماط حسب الأولوية أو تاريخ الإنشاء
- تحديد النمط الافتراضي لنوع المستند
- استرجاع معلومات أساسية عن كل نمط
- توفير معلومات عن نسبة استخدام كل نمط
- تطبيق فلترة حسب صلاحيات المستخدم

#### GetPatternVariablesQuery
استرجاع المتغيرات المتاحة للاستخدام في أنماط الترميز.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم للوصول لمعلومات متغيرات الترميز
- دعم تصفية المتغيرات حسب النوع أو مصدر البيانات
- دعم البحث عن متغير محدد
- استرجاع معلومات تفصيلية عن كل متغير
- تقديم أمثلة على قيم المتغيرات
- استرجاع إحصائيات استخدام المتغيرات في الأنماط
- تطبيق فلترة حسب صلاحيات المستخدم
- دعم الصفحات لتحسين الأداء

#### GetPatternFunctionsQuery
استرجاع الدوال المتاحة للاستخدام في أنماط الترميز.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم للوصول لمعلومات دوال الترميز
- دعم تصفية الدوال حسب النوع أو المخرجات
- دعم البحث عن دالة محددة
- استرجاع معلومات تفصيلية عن كل دالة
- تقديم أمثلة على استخدام الدوال
- استرجاع توثيق الدوال ومعلمات الإدخال والإخراج
- تطبيق فلترة حسب صلاحيات المستخدم
- دعم الصفحات لتحسين الأداء

#### GetPatternGroupsQuery
استرجاع مجموعات أنماط الترميز.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم للوصول لمعلومات مجموعات الترميز
- دعم تصفية المجموعات حسب الحالة أو النوع
- استرجاع معلومات تفصيلية عن كل مجموعة
- استرجاع قائمة الأنماط المنتمية لكل مجموعة
- استرجاع الإعدادات المشتركة وقواعد التصميم
- استرجاع معلومات الصلاحيات وإدارة المجموعة
- تطبيق فلترة حسب صلاحيات المستخدم
- دعم الصفحات لتحسين الأداء

#### GetDocumentNumberingLogQuery
استرجاع سجل توليد واستخدام رموز المستندات.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم للوصول لسجل الترميز
- دعم تصفية السجل حسب نمط الترميز أو نوع المستند
- دعم تصفية السجل حسب الفترة الزمنية
- دعم البحث عن رمز محدد أو مستند محدد
- استرجاع معلومات تفصيلية عن عمليات توليد الرموز
- استرجاع إحصائيات استخدام الرموز
- تطبيق فلترة حسب صلاحيات المستخدم
- دعم الصفحات لتحسين الأداء

#### GetPatternTemplatesQuery
استرجاع قوالب أنماط الترميز الجاهزة.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم للوصول لقوالب الترميز
- دعم تصفية القوالب حسب الفئة أو نوع المستند
- دعم البحث عن قالب محدد
- استرجاع معلومات تفصيلية عن كل قالب
- استرجاع أمثلة للرموز المولدة باستخدام القالب
- تصنيف القوالب حسب درجة التعقيد والاستخدام
- تطبيق فلترة حسب صلاحيات المستخدم
- دعم الصفحات لتحسين الأداء

#### GetPatternUsageStatisticsQuery
استرجاع إحصائيات استخدام أنماط الترميز.

**منطق الأعمال والتحققات**:
- التحقق من صلاحية المستخدم للوصول لإحصائيات الترميز
- جمع بيانات استخدام أنماط الترميز المختلفة
- تحليل أنماط الترميز الأكثر استخداماً
- تحليل أوقات الاستجابة وأداء توليد الرموز
- كشف أنماط الترميز التي تواجه مشكلات
- تقييم استخدام المتغيرات والدوال في الأنماط
- استرجاع اتجاهات استخدام الترميز عبر الزمن
- توفير بيانات لتحسين نظام الترميز

### الأحداث (Events)

#### DocumentNumberingPatternCreatedEvent
حدث يتم إطلاقه عند إنشاء نمط ترميز جديد.

#### DocumentNumberingPatternUpdatedEvent
حدث يتم إطلاقه عند تحديث نمط ترميز موجود.

#### DocumentNumberingPatternDisabledEvent
حدث يتم إطلاقه عند تعطيل نمط ترميز.

#### DocumentNumberingPatternDeletedEvent
حدث يتم إطلاقه عند حذف نمط ترميز.

#### DocumentNumberGeneratedEvent
حدث يتم إطلاقه عند توليد رمز جديد لمستند.

#### PatternVariableAddedEvent
حدث يتم إطلاقه عند إضافة متغير ترميز جديد.

#### PatternFunctionAddedEvent
حدث يتم إطلاقه عند إضافة دالة ترميز جديدة.

#### PatternGroupCreatedEvent
حدث يتم إطلاقه عند إنشاء مجموعة ترميز جديدة.

### خدمات المجال (Domain Services)

#### DocumentNumberingService
خدمة أساسية لإدارة ترميز المستندات:
- توليد رموز المستندات وفقاً للأنماط المحددة
- التحقق من تفرد الرموز المولدة
- معالجة تضارب توليد الرموز المتزامنة
- تطبيق قواعد الأعمال المتعلقة بالترميز
- احتفاظ بسجل توليد واستخدام الرموز

#### PatternEvaluationService
خدمة تقوم بتقييم ومعالجة أنماط الترميز:
- تفسير قالب النمط وتحليل مكوناته
- استرجاع قيم المتغيرات من مصادرها
- تنفيذ الدوال المستخدمة في النمط
- معالجة التعبيرات المنطقية والشرطية
- توليد النتيجة النهائية للنمط

#### PatternValidationService
خدمة للتحقق من صحة أنماط الترميز:
- التحقق من صحة بناء النمط
- التحقق من توافق المتغيرات والدوال المستخدمة
- كشف الأخطاء والمشاكل المحتملة
- التحقق من مطابقة الرموز المولدة للمتطلبات
- تقديم اقتراحات لتحسين النمط

#### NumberingPatternCopyService
خدمة لنسخ ومضاعفة أنماط الترميز:
- نسخ الأنماط مع الحفاظ على بنيتها
- تخصيص الأنماط المنسوخة حسب الحاجة
- ضمان تفرد النمط الجديد وسلامة بياناته
- معالجة المراجع والعلاقات في النمط المنسوخ
- تطبيق قواعد نسخ مختلفة حسب نوع النمط

## اختصارات لوحة المفاتيح وأزرار الشاشة السريعة

### اختصارات لوحة المفاتيح
- **F1**: عرض المساعدة والتوثيق الخاص بشاشة إعدادات ترميز المستندات
- **F2**: فتح شاشة إضافة نمط ترميز جديد
- **F3**: تحديث قائمة أنماط الترميز
- **F4**: تعديل النمط المحدد
- **F5**: اختبار النمط المحدد
- **F6**: فتح محرر نمط الترميز
- **F7**: إضافة متغير جديد
- **F8**: الانتقال إلى مجموعات الترميز
- **F9**: تصدير قائمة أنماط الترميز إلى ملف
- **Ctrl+A**: تحديد جميع أنماط الترميز
- **Ctrl+C**: نسخ النمط المحدد
- **Ctrl+S**: حفظ التغييرات
- **Ctrl+D**: تغيير حالة النمط (تفعيل/تعطيل)
- **Ctrl+T**: إضافة قالب نمط جديد
- **Alt+F4**: إغلاق الشاشة
- **Ctrl+P**: طباعة قائمة أنماط الترميز

### أزرار الشاشة السريعة
- **زر إضافة نمط**: إضافة نمط ترميز جديد
- **زر تعديل النمط**: تعديل النمط المحدد
- **زر حذف النمط**: حذف النمط المحدد
- **زر نسخ النمط**: نسخ النمط المحدد
- **زر اختبار النمط**: اختبار النمط المحدد
- **زر تفعيل/تعطيل النمط**: تغيير حالة النمط بين نشط ومعطل
- **زر محرر النمط**: فتح محرر نمط الترميز
- **زر المتغيرات**: إدارة متغيرات الترميز
- **زر الدوال**: إدارة دوال معالجة الترميز
- **زر القوالب**: إدارة قوالب أنماط الترميز
- **زر المجموعات**: إدارة مجموعات الترميز
- **زر السجل**: عرض سجل توليد واستخدام الرموز
- **زر الإعدادات المتقدمة**: ضبط الإعدادات المتقدمة للترميز
- **زر المعاينة**: معاينة الرموز المولدة
- **زر المساعدة**: عرض مساعدة شاشة إعدادات ترميز المستندات 
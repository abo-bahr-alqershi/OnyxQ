# شاشة دليل الحسابات (Chart of Accounts)

## المكونات الرئيسية للشاشة:

### 1. الأقسام والحقول:
- **قسم البيانات الأساسية**:
  - رمز الحساب (Account Code): الرمز الفريد للحساب (يتكون من أرقام وقد يحتوي على حروف)
  - اسم الحساب (Account Name): الاسم العربي للحساب
  - اسم الحساب بالإنجليزية (English Name): الاسم الإنجليزي للحساب
  - مستوى الحساب (Account Level): يحدد موقع الحساب في التسلسل الهرمي (مستوى 1 للرئيسية، 2 للفرعية وهكذا)
  - الحساب الأب (Parent Account): الحساب الذي يتبع له هذا الحساب
  - نوع الحساب (Account Type): تصنيف الحساب (ميزانية، دخل، مصروفات، أصول، خصوم، إلخ)
  - تصنيف التقرير (Report Classification): تصنيف الحساب للتقارير المالية

- **قسم الإعدادات المتقدمة**:
  - الطبيعة (Nature): دائن أو مدين
  - تصنيف المجموعة (Group Classification): التصنيف ضمن مجموعات الحسابات
  - نوع التحليل (Analysis Type): طريقة تحليل الحساب في التقارير
  - فهرس الإغلاق (Closing Index): ترتيب الحساب في عمليات الإغلاق
  - استخدام مراكز التكلفة (Use Cost Centers): هل الحساب يرتبط بمراكز تكلفة
  - استخدام المشاريع (Use Projects): هل الحساب يرتبط بمشاريع
  - استخدام الأنشطة (Use Activities): هل الحساب يرتبط بأنشطة

- **قسم العملات والحسابات الفرعية**:
  - رمز عملة الحساب (Currency Code): العملة الافتراضية للحساب
  - حساب فروق العملة (Currency Difference Account): الحساب المستخدم لفروق العملة
  - نوع الحساب التفصيلي (Detail Account Type): تصنيف الحساب التفصيلي (عام، عميل، مورد، موظف، بنك)

- **قسم المعلومات الإضافية**:
  - حالة الحساب (Active/Inactive): مفعل أو معطل
  - سبب التعطيل (Inactive Reason): سبب تعطيل الحساب (إن وجد)
  - تاريخ التعطيل (Inactive Date): تاريخ تعطيل الحساب
  - معلومات المستخدم (User Info): المستخدم الذي أنشأ/عدل الحساب
  - تاريخ الإنشاء/التعديل (Creation/Update Date): تواريخ الإنشاء والتعديل

### 2. شريط الأدوات:
- أزرار الإضافة، التعديل، الحذف، الحفظ، الإلغاء
- أدوات البحث والتصفية والفرز
- أزرار استيراد وتصدير البيانات
- زر طباعة الدليل المحاسبي
- زر عرض الأرصدة
- زر عرض حركة الحساب

### 3. الشجرة الهرمية للحسابات:
- عرض للحسابات بشكل شجري مع إمكانية الطي والتوسيع
- تمييز مستويات الحسابات بألوان مختلفة
- إمكانية السحب والإفلات لإعادة ترتيب الحسابات

## وظائف وعمليات الشاشة:

### 1. الوظائف الرئيسية:
- **إنشاء وتنظيم الحسابات**: إضافة حسابات جديدة وتنظيمها ضمن هيكل هرمي
- **إدارة مستويات الحسابات**: إمكانية تحديد مستويات متعددة للحسابات (حتى 10 مستويات)
- **ربط الحسابات**: ربط الحسابات مع بعضها البعض في علاقات أب/ابن
- **تصنيف الحسابات**: تصنيف الحسابات حسب نوعها وطبيعتها واستخدامها
- **إدارة العملات**: تحديد العملات المرتبطة بالحسابات وتعريف حسابات فروق العملة
- **إدارة التفاصيل**: ربط الحسابات مع التفاصيل المختلفة (العملاء، الموردين، الموظفين)

### 2. العمليات المتقدمة:
- **استيراد/تصدير**: استيراد دليل الحسابات من ملفات Excel أو تصديره
- **النسخ والنقل**: نسخ حسابات أو مجموعات حسابات أو نقلها بين المستويات
- **دمج الحسابات**: دمج حسابين أو أكثر في حساب واحد
- **تغيير الكود**: تغيير رمز الحساب مع الحفاظ على جميع الحركات
- **الإغلاق الجماعي**: تفعيل أو تعطيل مجموعة من الحسابات دفعة واحدة
- **توليد التقارير**: إنشاء تقارير مختلفة عن هيكل الحسابات وأرصدتها

### 3. الارتباط مع الشاشات الأخرى:
- **ارتباط مع شاشة القيود**: تستخدم الحسابات عند إنشاء قيود محاسبية
- **ارتباط مع شاشة مراكز التكلفة**: ربط الحسابات مع مراكز التكلفة
- **ارتباط مع شاشة المشاريع**: ربط الحسابات مع المشاريع
- **ارتباط مع شاشة العملات**: ربط الحسابات مع العملات المختلفة
- **ارتباط مع شاشات التقارير**: استخدام الحسابات في التقارير المالية المختلفة

## الأوامر والاستعلامات في طبقة التطبيق (Application Layer)

### 1. الكيانات الرئيسية (Entities):

- **Account (الحساب)**: الكيان الرئيسي لتمثيل حساب في شجرة الحسابات
- **AccountCurrency (عملة الحساب)**: كيان يمثل العملات المرتبطة بالحساب

### 2. أوامر إدارة الحسابات (Commands):

- **CreateAccountCommand (أمر إنشاء حساب جديد)**:
  - الغرض: إنشاء حساب جديد في دليل الحسابات
  - المدخلات الرئيسية: رمز الحساب، اسم الحساب، رمز الحساب الأب، نوع الحساب، الطبيعة
  - العمليات: التحقق من تفرد الرمز، التحقق من وجود الحساب الأب، تحديد المستوى تلقائياً، إنشاء الحساب

- **UpdateAccountCommand (أمر تحديث حساب)**:
  - الغرض: تحديث بيانات حساب موجود
  - المدخلات الرئيسية: رمز الحساب، البيانات المراد تحديثها
  - العمليات: التحقق من وجود الحساب، تحديث البيانات المطلوبة مع الحفاظ على سلامة العلاقات

- **ChangeAccountCodeCommand (أمر تغيير رمز الحساب)**:
  - الغرض: تغيير رمز الحساب مع الحفاظ على جميع علاقاته وحركاته
  - المدخلات الرئيسية: الرمز القديم، الرمز الجديد
  - العمليات: التحقق من عدم وجود حساب بالرمز الجديد، تحديث الحساب وجميع الإشارات إليه في القيود والحركات

- **ToggleAccountStatusCommand (أمر تفعيل/تعطيل حساب)**:
  - الغرض: تفعيل أو تعطيل حساب
  - المدخلات الرئيسية: رمز الحساب، حالة التفعيل، سبب التعطيل (اختياري)
  - العمليات: تحديث حالة الحساب مع التحقق من إمكانية تعطيله (عدم وجود حركات نشطة)

- **AddAccountCurrencyCommand (أمر إضافة عملة للحساب)**:
  - الغرض: ربط عملة بحساب معين
  - المدخلات الرئيسية: رمز الحساب، رمز العملة
  - العمليات: التحقق من وجود الحساب والعملة، إضافة العملة للحساب إذا لم تكن موجودة

- **RemoveAccountCurrencyCommand (أمر إزالة عملة من الحساب)**:
  - الغرض: إزالة ارتباط عملة من حساب معين
  - المدخلات الرئيسية: رمز الحساب، رمز العملة
  - العمليات: التحقق من وجود الارتباط، إزالته مع التحقق من عدم وجود حركات بهذه العملة

- **ImportAccountsFromExcelCommand (أمر استيراد الحسابات من Excel)**:
  - الغرض: استيراد مجموعة حسابات من ملف Excel
  - المدخلات الرئيسية: محتوى الملف، نوع الملف
  - العمليات: قراءة بيانات الملف، التحقق من صحتها، إنشاء الحسابات الجديدة أو تحديث القائمة

- **MergeAccountsCommand (أمر دمج الحسابات)**:
  - الغرض: دمج حسابين أو أكثر في حساب واحد
  - المدخلات الرئيسية: رمز الحساب الرئيسي، قائمة رموز الحسابات المراد دمجها
  - العمليات: نقل جميع الحركات والأرصدة من الحسابات المدمجة إلى الحساب الرئيسي

- **MoveAccountCommand (أمر نقل حساب)**:
  - الغرض: نقل حساب من مستوى أو حساب أب إلى آخر
  - المدخلات الرئيسية: رمز الحساب، رمز الحساب الأب الجديد
  - العمليات: تحديث علاقة الحساب الأب، تحديث مستوى الحساب والحسابات الفرعية

- **CopyAccountCommand (أمر نسخ حساب)**:
  - الغرض: نسخ حساب لإنشاء حساب جديد بنفس الخصائص
  - المدخلات الرئيسية: رمز الحساب المصدر، رمز الحساب الجديد، اسم الحساب الجديد
  - العمليات: إنشاء نسخة من الحساب المصدر بالرمز والاسم الجديدين

- **BulkToggleAccountsStatusCommand (أمر تعديل حالة مجموعة حسابات)**:
  - الغرض: تفعيل أو تعطيل مجموعة من الحسابات دفعة واحدة
  - المدخلات الرئيسية: قائمة رموز الحسابات، حالة التفعيل، سبب التعطيل (اختياري)
  - العمليات: تحديث حالة جميع الحسابات المحددة مع التحقق من شروط التعطيل

### 3. استعلامات الحسابات (Queries):

- **GetAccountByCodeQuery (استعلام للحصول على حساب بالرمز)**:
  - الغرض: الحصول على معلومات حساب محدد بواسطة رمزه
  - المدخلات: رمز الحساب
  - المخرجات: بيانات الحساب كاملة (معلومات أساسية، إعدادات متقدمة، عملات مرتبطة)

- **GetChildAccountsQuery (استعلام للحصول على الحسابات الفرعية)**:
  - الغرض: الحصول على قائمة الحسابات الفرعية المباشرة لحساب رئيسي
  - المدخلات: رمز الحساب الأب
  - المخرجات: قائمة بالحسابات الفرعية المباشرة

- **GetAccountsTreeQuery (استعلام للحصول على شجرة الحسابات)**:
  - الغرض: الحصول على هيكل شجري للحسابات بدءاً من حساب جذر معين
  - المدخلات: رمز الحساب الجذر (اختياري)، العمق الأقصى، خيار تضمين الحسابات المعطلة
  - المخرجات: هيكل شجري متداخل للحسابات يسمح بعرضها بشكل هرمي

- **SearchAccountsQuery (استعلام للبحث في الحسابات)**:
  - الغرض: البحث عن الحسابات باستخدام معايير متعددة
  - المدخلات: نص البحث، نوع الحساب، حالة التفعيل، رقم الصفحة، حجم الصفحة
  - المخرجات: قائمة بالحسابات المطابقة للمعايير مع إجمالي العدد للتصفح

- **GetAccountBalancesQuery (استعلام لعرض أرصدة الحسابات)**:
  - الغرض: عرض أرصدة حساب معين أو مجموعة حسابات خلال فترة محددة
  - المدخلات: رمز الحساب (قد يكون جذراً لمجموعة)، الفترة الزمنية، العملة
  - المخرجات: قائمة بالحسابات وأرصدتها (مدين، دائن، الرصيد النهائي)

- **GetAccountTransactionsQuery (استعلام للحصول على حركة الحساب)**:
  - الغرض: عرض تفاصيل الحركات المحاسبية لحساب معين خلال فترة محددة
  - المدخلات: رمز الحساب، الفترة الزمنية، العملة، رقم الصفحة، حجم الصفحة
  - المخرجات: قائمة بالحركات المحاسبية (قيود، مستندات) مع التفاصيل والأرصدة التراكمية

- **GetAccountCurrenciesQuery (استعلام للحصول على عملات الحساب)**:
  - الغرض: عرض العملات المرتبطة بحساب معين
  - المدخلات: رمز الحساب
  - المخرجات: قائمة بالعملات المرتبطة وحالتها (مفعلة/معطلة)

- **ValidateAccountCodeQuery (استعلام للتحقق من صحة رمز الحساب)**:
  - الغرض: التحقق من صحة وتفرد رمز حساب جديد قبل الإنشاء
  - المدخلات: رمز الحساب المقترح
  - المخرجات: نتيجة التحقق (متاح/غير متاح) مع سبب عدم الإتاحة إن وجد

- **GetAccountsForSelectionQuery (استعلام للحصول على قائمة الحسابات للاختيار)**:
  - الغرض: توفير قائمة مختصرة بالحسابات للاستخدام في قوائم الاختيار
  - المدخلات: نوع الحساب (اختياري)، نمط البحث (اختياري)
  - المخرجات: قائمة مختصرة بالحسابات تتضمن الرمز والاسم فقط

- **GetAccountHierarchyPathQuery (استعلام للحصول على مسار الحساب الهرمي)**:
  - الغرض: الحصول على المسار الكامل للحساب في التسلسل الهرمي
  - المدخلات: رمز الحساب
  - المخرجات: مسار كامل من الجذر إلى الحساب المحدد

- **GetAccountsReportQuery (استعلام لتقرير الحسابات)**:
  - الغرض: إنشاء تقرير مفصل عن الحسابات حسب معايير محددة
  - المدخلات: نوع التقرير، معايير التصفية، خيارات التجميع
  - المخرجات: بيانات التقرير حسب المعايير المحددة

## ملاحظات تقنية إضافية

1. **أمان البيانات**:
   - التحقق من صلاحيات المستخدم قبل تنفيذ أي عملية
   - تشفير البيانات الحساسة
   - تسجيل جميع العمليات في سجل التدقيق

2. **التحقق من صحة البيانات**:
   - التحقق من تفرد رمز الحساب
   - التحقق من صحة العلاقات بين الحسابات
   - التحقق من صحة نوع الحساب والطبيعة والتصنيف

3. **الأداء**:
   - استخدام الفهارس المناسبة لتحسين أداء الاستعلامات
   - تحميل البيانات بشكل محسن (Eager Loading) للعلاقات
   - استخدام الصفحات في الاستعلامات التي تعيد كميات كبيرة من البيانات

4. **قابلية التوسع**:
   - تصميم النظام ليدعم عدد كبير من الحسابات
   - دعم مستويات متعددة من الحسابات (حتى 10 مستويات)
   - دعم العملات المتعددة والحسابات متعددة العملات

5. **دعم التكامل**:
   - واجهة برمجة تطبيقات RESTful لتكامل النظام مع أنظمة أخرى
   - دعم استيراد/تصدير البيانات من/إلى أنظمة أخرى
   - إشعارات وأحداث النطاق لتنبيه الأنظمة الأخرى بالتغييرات 
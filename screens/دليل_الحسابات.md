# شاشة دليل الحسابات (Chart of Accounts)

## المكونات الرئيسية للشاشة:

### 1. الأقسام والحقول:
- **قسم البيانات الأساسية**:
  - رمز الحساب (Account Code): الرمز الفريد للحساب (يتكون من أرقام وقد يحتوي على حروف)
  - اسم الحساب (Account Name): الاسم العربي للحساب
  - اسم الحساب بالإنجليزية (English Name): الاسم الإنجليزي للحساب
  - مستوى الحساب (Account Level): يحدد موقع الحساب في التسلسل الهرمي (مستوى 1 للرئيسية، 2 للفرعية وهكذا)
  - الحساب الأب (Parent Account): الحساب الذي يتبع له هذا الحساب
  - نوع الحساب (Account Type): تصنيف الحساب (ميزانية، دخل، مصروفات، أصول، خصوم، إلخ)
  - تصنيف التقرير (Report Classification): تصنيف الحساب للتقارير المالية

- **قسم الإعدادات المتقدمة**:
  - الطبيعة (Nature): دائن أو مدين
  - تصنيف المجموعة (Group Classification): التصنيف ضمن مجموعات الحسابات
  - نوع التحليل (Analysis Type): طريقة تحليل الحساب في التقارير
  - فهرس الإغلاق (Closing Index): ترتيب الحساب في عمليات الإغلاق
  - استخدام مراكز التكلفة (Use Cost Centers): هل الحساب يرتبط بمراكز تكلفة
  - استخدام المشاريع (Use Projects): هل الحساب يرتبط بمشاريع
  - استخدام الأنشطة (Use Activities): هل الحساب يرتبط بأنشطة

- **قسم العملات والحسابات الفرعية**:
  - رمز عملة الحساب (Currency Code): العملة الافتراضية للحساب
  - حساب فروق العملة (Currency Difference Account): الحساب المستخدم لفروق العملة
  - نوع الحساب التفصيلي (Detail Account Type): تصنيف الحساب التفصيلي (عام، عميل، مورد، موظف، بنك)

- **قسم المعلومات الإضافية**:
  - حالة الحساب (Active/Inactive): مفعل أو معطل
  - سبب التعطيل (Inactive Reason): سبب تعطيل الحساب (إن وجد)
  - تاريخ التعطيل (Inactive Date): تاريخ تعطيل الحساب
  - معلومات المستخدم (User Info): المستخدم الذي أنشأ/عدل الحساب
  - تاريخ الإنشاء/التعديل (Creation/Update Date): تواريخ الإنشاء والتعديل

### 2. شريط الأدوات:
- أزرار الإضافة، التعديل، الحذف، الحفظ، الإلغاء
- أدوات البحث والتصفية والفرز
- أزرار استيراد وتصدير البيانات
- زر طباعة الدليل المحاسبي
- زر عرض الأرصدة
- زر عرض حركة الحساب

### 3. الشجرة الهرمية للحسابات:
- عرض للحسابات بشكل شجري مع إمكانية الطي والتوسيع
- تمييز مستويات الحسابات بألوان مختلفة
- إمكانية السحب والإفلات لإعادة ترتيب الحسابات

## وظائف وعمليات الشاشة:

### 1. الوظائف الرئيسية:
- **إنشاء وتنظيم الحسابات**: إضافة حسابات جديدة وتنظيمها ضمن هيكل هرمي
- **إدارة مستويات الحسابات**: إمكانية تحديد مستويات متعددة للحسابات (حتى 10 مستويات)
- **ربط الحسابات**: ربط الحسابات مع بعضها البعض في علاقات أب/ابن
- **تصنيف الحسابات**: تصنيف الحسابات حسب نوعها وطبيعتها واستخدامها
- **إدارة العملات**: تحديد العملات المرتبطة بالحسابات وتعريف حسابات فروق العملة
- **إدارة التفاصيل**: ربط الحسابات مع التفاصيل المختلفة (العملاء، الموردين، الموظفين)

### 2. العمليات المتقدمة:
- **استيراد/تصدير**: استيراد دليل الحسابات من ملفات Excel أو تصديره
- **النسخ والنقل**: نسخ حسابات أو مجموعات حسابات أو نقلها بين المستويات
- **دمج الحسابات**: دمج حسابين أو أكثر في حساب واحد
- **تغيير الكود**: تغيير رمز الحساب مع الحفاظ على جميع الحركات
- **الإغلاق الجماعي**: تفعيل أو تعطيل مجموعة من الحسابات دفعة واحدة
- **توليد التقارير**: إنشاء تقارير مختلفة عن هيكل الحسابات وأرصدتها

### 3. الارتباط مع الشاشات الأخرى:
- **ارتباط مع شاشة القيود**: تستخدم الحسابات عند إنشاء قيود محاسبية
- **ارتباط مع شاشة مراكز التكلفة**: ربط الحسابات مع مراكز التكلفة
- **ارتباط مع شاشة المشاريع**: ربط الحسابات مع المشاريع
- **ارتباط مع شاشة العملات**: ربط الحسابات مع العملات المختلفة
- **ارتباط مع شاشات التقارير**: استخدام الحسابات في التقارير المالية المختلفة

## الأوامر والاستعلامات في طبقة التطبيق (Application Layer)

### 1. الكيانات الرئيسية (Entities):

- **Account (الحساب)**: الكيان الرئيسي لتمثيل حساب في شجرة الحسابات
- **AccountCurrency (عملة الحساب)**: كيان يمثل العملات المرتبطة بالحساب

### 2. أوامر إدارة الحسابات (Commands):

- **CreateAccountCommand (أمر إنشاء حساب جديد)**:
  - الغرض: إنشاء حساب جديد في دليل الحسابات
  - المدخلات الرئيسية: رمز الحساب، اسم الحساب، رمز الحساب الأب، نوع الحساب، الطبيعة
  - العمليات: التحقق من تفرد الرمز، التحقق من وجود الحساب الأب، تحديد المستوى تلقائياً، إنشاء الحساب
  - **منطق الأعمال والتحققات**:
    - التحقق من أن رمز الحساب فريد وغير مستخدم مسبقاً
    - التحقق من تناسق رمز الحساب مع نمط الترميز المعتمد (طول الرمز، الأحرف المسموحة)
    - التحقق من وجود الحساب الأب إذا تم تحديده
    - التحقق من أن مستوى الحساب متوافق مع مستوى الحساب الأب (مستوى الأب + 1)
    - التحقق من اتساق نوع الحساب مع نوع الحساب الأب (مثلاً، حساب مصروفات لا يمكن أن يكون تحت حساب إيرادات)
    - التحقق من صحة طبيعة الحساب (دائن/مدين) بناءً على نوع الحساب
    - التحقق من صلاحيات المستخدم لإنشاء حسابات في هذا المستوى

- **UpdateAccountCommand (أمر تحديث حساب)**:
  - الغرض: تحديث بيانات حساب موجود
  - المدخلات الرئيسية: رمز الحساب، البيانات المراد تحديثها
  - العمليات: التحقق من وجود الحساب، تحديث البيانات المطلوبة مع الحفاظ على سلامة العلاقات
  - **منطق الأعمال والتحققات**:
    - التحقق من وجود الحساب المراد تحديثه
    - التحقق من عدم تعديل حقول أساسية إذا كان للحساب حركات أو أرصدة
    - التحقق من عدم تغيير نوع الحساب بشكل يتعارض مع الحسابات الفرعية المرتبطة به
    - حماية الحسابات النظامية من التعديلات غير المسموحة
    - التحقق من صلاحيات المستخدم لتعديل الحساب
    - إذا تم تعديل اسم الحساب، يجب التأكد من تحديث جميع المراجع ذات الصلة
    - حفظ تاريخ التعديل والمستخدم الذي قام بالتعديل

- **ChangeAccountCodeCommand (أمر تغيير رمز الحساب)**:
  - الغرض: تغيير رمز الحساب مع الحفاظ على جميع علاقاته وحركاته
  - المدخلات الرئيسية: الرمز القديم، الرمز الجديد
  - العمليات: التحقق من عدم وجود حساب بالرمز الجديد، تحديث الحساب وجميع الإشارات إليه في القيود والحركات
  - **منطق الأعمال والتحققات**:
    - التحقق من أن الرمز الجديد غير مستخدم
    - التحقق من تناسب الرمز الجديد مع نمط الترميز المعتمد
    - التحقق من إمكانية تغيير الرمز (بعض الحسابات النظامية قد لا يمكن تغيير رموزها)
    - تحديث جميع القيود المحاسبية التي تشير إلى الحساب
    - تحديث جميع العلاقات مع الحسابات الأخرى (الحسابات الفرعية، حسابات فروق العملة)
    - تنفيذ العملية ضمن وحدة عمل واحدة (Transaction) لضمان اتساق البيانات
    - الاحتفاظ بسجل للتغيير في سجل التدقيق

- **ToggleAccountStatusCommand (أمر تفعيل/تعطيل حساب)**:
  - الغرض: تفعيل أو تعطيل حساب
  - المدخلات الرئيسية: رمز الحساب، حالة التفعيل، سبب التعطيل (اختياري)
  - العمليات: تحديث حالة الحساب مع التحقق من إمكانية تعطيله (عدم وجود حركات نشطة)
  - **منطق الأعمال والتحققات**:
    - التحقق من وجود الحساب
    - التحقق من إمكانية تعطيل الحساب (عدم وجود حركات نشطة أو أرصدة غير مصفاة)
    - التحقق من عدم استخدام الحساب في عمليات آلية أو قيود متكررة
    - التحقق من عدم وجود حسابات فرعية نشطة قبل تعطيل الحساب الأب
    - إذا كان التعطيل، تسجيل سبب التعطيل وتاريخه
    - التحقق من صلاحيات المستخدم لتفعيل/تعطيل الحساب
    - ضمان عدم تعطيل الحسابات الأساسية التي يعتمد عليها النظام

- **AddAccountCurrencyCommand (أمر إضافة عملة للحساب)**:
  - الغرض: ربط عملة بحساب معين
  - المدخلات الرئيسية: رمز الحساب، رمز العملة
  - العمليات: التحقق من وجود الحساب والعملة، إضافة العملة للحساب إذا لم تكن موجودة
  - **منطق الأعمال والتحققات**:
    - التحقق من وجود الحساب والعملة
    - التحقق من عدم وجود العملة بالفعل للحساب
    - التحقق من أن نوع الحساب يدعم العملات المتعددة
    - التحقق من صلاحيات المستخدم لإضافة عملات
    - إذا كانت العملة الأولى للحساب، تعيينها كعملة افتراضية
    - ضمان وجود حساب فروق عملة مرتبط إذا كان ذلك مطلوباً

- **RemoveAccountCurrencyCommand (أمر إزالة عملة من الحساب)**:
  - الغرض: إزالة ارتباط عملة من حساب معين
  - المدخلات الرئيسية: رمز الحساب، رمز العملة
  - العمليات: التحقق من وجود الارتباط، إزالته مع التحقق من عدم وجود حركات بهذه العملة
  - **منطق الأعمال والتحققات**:
    - التحقق من وجود الحساب والعملة
    - التحقق من أن العملة مرتبطة بالفعل بالحساب
    - التحقق من عدم وجود حركات أو أرصدة للحساب بهذه العملة
    - التحقق من أن العملة ليست العملة الافتراضية للحساب
    - التحقق من صلاحيات المستخدم لإزالة عملات
    - إذا كانت آخر عملة للحساب، التحقق من سياسة النظام تجاه ذلك

- **ImportAccountsFromExcelCommand (أمر استيراد الحسابات من Excel)**:
  - الغرض: استيراد مجموعة حسابات من ملف Excel
  - المدخلات الرئيسية: محتوى الملف، نوع الملف
  - العمليات: قراءة بيانات الملف، التحقق من صحتها، إنشاء الحسابات الجديدة أو تحديث القائمة
  - **منطق الأعمال والتحققات**:
    - التحقق من صحة تنسيق الملف وهيكله
    - التحقق من تفرد رموز الحسابات في الملف وفي النظام
    - التحقق من صحة العلاقات بين الحسابات (الأب/الابن) في الملف
    - التحقق من اتساق بيانات الحسابات (النوع، الطبيعة، المستوى)
    - تنفيذ الاستيراد بطريقة تدريجية مع تسجيل الأخطاء لكل حساب
    - توفير خيار للاستيراد الجزئي (تجاهل الحسابات التي بها أخطاء)
    - التحقق من صلاحيات المستخدم للاستيراد

- **MergeAccountsCommand (أمر دمج الحسابات)**:
  - الغرض: دمج حسابين أو أكثر في حساب واحد
  - المدخلات الرئيسية: رمز الحساب الرئيسي، قائمة رموز الحسابات المراد دمجها
  - العمليات: نقل جميع الحركات والأرصدة من الحسابات المدمجة إلى الحساب الرئيسي
  - **منطق الأعمال والتحققات**:
    - التحقق من وجود جميع الحسابات المعنية بعملية الدمج
    - التحقق من تجانس الحسابات (نفس النوع، نفس الطبيعة)
    - التحقق من عدم وجود حسابات فرعية للحسابات المراد دمجها
    - نقل جميع الحركات المحاسبية من الحسابات المدمجة إلى الحساب الرئيسي
    - معالجة تضارب العملات إذا كانت الحسابات تستخدم عملات مختلفة
    - تنفيذ العملية ضمن وحدة عمل واحدة (Transaction)
    - الاحتفاظ بسجل للحسابات المدمجة للرجوع إليه مستقبلاً
    - التحقق من صلاحيات المستخدم لدمج الحسابات

- **MoveAccountCommand (أمر نقل حساب)**:
  - الغرض: نقل حساب من مستوى أو حساب أب إلى آخر
  - المدخلات الرئيسية: رمز الحساب، رمز الحساب الأب الجديد
  - العمليات: تحديث علاقة الحساب الأب، تحديث مستوى الحساب والحسابات الفرعية
  - **منطق الأعمال والتحققات**:
    - التحقق من وجود الحساب والحساب الأب الجديد
    - التحقق من أن النقل لا يؤدي إلى دورة في هيكل الحسابات (الحساب المنقول ليس أباً للحساب الأب الجديد)
    - التحقق من تناسق نوع الحساب مع نوع الحساب الأب الجديد
    - تحديث مستوى الحساب ومستويات جميع الحسابات الفرعية بشكل تسلسلي
    - التحقق من أن النقل لا يتجاوز الحد الأقصى لمستويات الحسابات
    - التحقق من صلاحيات المستخدم لنقل الحسابات
    - مراعاة تأثير النقل على تقارير وتحليلات الحسابات

- **CopyAccountCommand (أمر نسخ حساب)**:
  - الغرض: نسخ حساب لإنشاء حساب جديد بنفس الخصائص
  - المدخلات الرئيسية: رمز الحساب المصدر، رمز الحساب الجديد، اسم الحساب الجديد
  - العمليات: إنشاء نسخة من الحساب المصدر بالرمز والاسم الجديدين
  - **منطق الأعمال والتحققات**:
    - التحقق من وجود الحساب المصدر
    - التحقق من أن الرمز الجديد غير مستخدم
    - التحقق من تناسب الرمز الجديد مع نمط الترميز المعتمد
    - تحديد مستوى الحساب الجديد بناءً على موقعه في الهيكل
    - نسخ جميع خصائص الحساب (النوع، الطبيعة، الإعدادات) ما عدا الرصيد والحركات
    - خيار نسخ العملات المرتبطة بالحساب المصدر
    - خيار نسخ الحسابات الفرعية (نسخ متعمق)
    - التحقق من صلاحيات المستخدم لنسخ الحسابات

- **BulkToggleAccountsStatusCommand (أمر تعديل حالة مجموعة حسابات)**:
  - الغرض: تفعيل أو تعطيل مجموعة من الحسابات دفعة واحدة
  - المدخلات الرئيسية: قائمة رموز الحسابات، حالة التفعيل، سبب التعطيل (اختياري)
  - العمليات: تحديث حالة جميع الحسابات المحددة مع التحقق من شروط التعطيل
  - **منطق الأعمال والتحققات**:
    - التحقق من وجود جميع الحسابات المحددة
    - تطبيق نفس قواعد التحقق الخاصة بـ ToggleAccountStatusCommand على كل حساب
    - توفير خيار للتطبيق الجزئي (تجاهل الحسابات التي لا يمكن تعديل حالتها)
    - تجميع الأخطاء وعرضها للمستخدم بشكل مفصل
    - تنفيذ العملية ضمن وحدة عمل واحدة إذا كان ذلك مناسباً
    - مراعاة تأثير العملية على الأداء إذا كان عدد الحسابات كبيراً
    - التحقق من صلاحيات المستخدم لتعديل حالة الحسابات بشكل جماعي

### 3. استعلامات الحسابات (Queries):

- **GetAccountByCodeQuery (استعلام للحصول على حساب بالرمز)**:
  - الغرض: الحصول على معلومات حساب محدد بواسطة رمزه
  - المدخلات: رمز الحساب
  - المخرجات: بيانات الحساب كاملة (معلومات أساسية، إعدادات متقدمة، عملات مرتبطة)
  - **منطق الأعمال والتحققات**:
    - التحقق من صلاحيات المستخدم لعرض بيانات الحساب
    - التحقق من صحة تنسيق رمز الحساب
    - تحميل البيانات ذات الصلة (العملات، الحساب الأب) بكفاءة
    - تضمين معلومات الرصيد الحالي إذا كان مطلوباً
    - تضمين تاريخ آخر حركة على الحساب
    - تعامل مناسب مع حالة عدم وجود الحساب

- **GetChildAccountsQuery (استعلام للحصول على الحسابات الفرعية)**:
  - الغرض: الحصول على قائمة الحسابات الفرعية المباشرة لحساب رئيسي
  - المدخلات: رمز الحساب الأب
  - المخرجات: قائمة بالحسابات الفرعية المباشرة
  - **منطق الأعمال والتحققات**:
    - التحقق من وجود الحساب الأب
    - التحقق من صلاحيات المستخدم لعرض الحسابات الفرعية
    - توفير خيارات للفرز (حسب الرمز، الاسم، الرصيد)
    - توفير خيار لتضمين/استبعاد الحسابات المعطلة
    - تحميل البيانات بكفاءة مع تجنب مشكلات الأداء للحسابات ذات العدد الكبير من الفروع
    - تضمين معلومات موجزة عن كل حساب فرعي (الرصيد، عدد الحسابات الفرعية)

- **GetAccountsTreeQuery (استعلام للحصول على شجرة الحسابات)**:
  - الغرض: الحصول على هيكل شجري للحسابات بدءاً من حساب جذر معين
  - المدخلات: رمز الحساب الجذر (اختياري)، العمق الأقصى، خيار تضمين الحسابات المعطلة
  - المخرجات: هيكل شجري متداخل للحسابات يسمح بعرضها بشكل هرمي
  - **منطق الأعمال والتحققات**:
    - التحقق من صلاحيات المستخدم لعرض الشجرة
    - استخدام استراتيجية التحميل المؤجل (Lazy Loading) للتعامل مع الأشجار الكبيرة
    - تحديد مستوى التفاصيل لكل مستوى من مستويات الشجرة
    - دعم التصفية حسب نوع الحساب أو معايير أخرى
    - حساب وتضمين الأرصدة المجمعة لكل فرع في الشجرة
    - التعامل مع الهياكل المعقدة والعميقة بكفاءة
    - إدارة الذاكرة بشكل جيد عند التعامل مع أشجار كبيرة

- **SearchAccountsQuery (استعلام للبحث في الحسابات)**:
  - الغرض: البحث عن الحسابات باستخدام معايير متعددة
  - المدخلات: نص البحث، نوع الحساب، حالة التفعيل، رقم الصفحة، حجم الصفحة
  - المخرجات: قائمة بالحسابات المطابقة للمعايير مع إجمالي العدد للتصفح
  - **منطق الأعمال والتحققات**:
    - التحقق من صلاحيات المستخدم للبحث في الحسابات
    - دعم البحث عن الرمز أو الاسم أو جزء منهما
    - دعم البحث المتقدم باستخدام معايير متعددة
    - تحسين أداء البحث باستخدام الفهارس المناسبة
    - تصفية النتائج حسب صلاحيات المستخدم
    - تنفيذ البحث بكفاءة عند البحث في عدد كبير من الحسابات
    - دعم البحث المراعي للغة العربية (تجاهل التشكيل، البحث بأشكال الهمزات المختلفة)

- **GetAccountBalancesQuery (استعلام لعرض أرصدة الحسابات)**:
  - الغرض: عرض أرصدة حساب معين أو مجموعة حسابات خلال فترة محددة
  - المدخلات: رمز الحساب (قد يكون جذراً لمجموعة)، الفترة الزمنية، العملة
  - المخرجات: قائمة بالحسابات وأرصدتها (مدين، دائن، الرصيد النهائي)
  - **منطق الأعمال والتحققات**:
    - التحقق من صلاحيات المستخدم لعرض الأرصدة
    - التحقق من صحة الفترة الزمنية
    - حساب الأرصدة الافتتاحية في بداية الفترة
    - حساب حركات الفترة (المدين، الدائن)
    - حساب الأرصدة الختامية في نهاية الفترة
    - دعم تجميع الأرصدة حسب المستوى
    - دعم تحويل العملات إذا كان مطلوباً
    - التعامل الصحيح مع الفترات المحاسبية المغلقة

- **GetAccountTransactionsQuery (استعلام للحصول على حركة الحساب)**:
  - الغرض: عرض تفاصيل الحركات المحاسبية لحساب معين خلال فترة محددة
  - المدخلات: رمز الحساب، الفترة الزمنية، العملة، رقم الصفحة، حجم الصفحة
  - المخرجات: قائمة بالحركات المحاسبية (قيود، مستندات) مع التفاصيل والأرصدة التراكمية
  - **منطق الأعمال والتحققات**:
    - التحقق من صلاحيات المستخدم لعرض حركة الحساب
    - التحقق من صحة الفترة الزمنية
    - حساب الرصيد الافتتاحي في بداية الفترة
    - عرض تفاصيل كل حركة (التاريخ، نوع المستند، الرقم، الوصف)
    - حساب الرصيد التراكمي بعد كل حركة
    - دعم تصفية الحركات حسب نوع المستند أو معايير أخرى
    - دعم الفرز حسب التاريخ أو المبلغ أو نوع المستند
    - تضمين روابط للوصول السريع إلى المستندات المرتبطة بالحركات

- **GetAccountCurrenciesQuery (استعلام للحصول على عملات الحساب)**:
  - الغرض: عرض العملات المرتبطة بحساب معين
  - المدخلات: رمز الحساب
  - المخرجات: قائمة بالعملات المرتبطة وحالتها (مفعلة/معطلة)
  - **منطق الأعمال والتحققات**:
    - التحقق من وجود الحساب
    - التحقق من صلاحيات المستخدم لعرض عملات الحساب
    - تضمين معلومات عن العملة الافتراضية للحساب
    - عرض معلومات عن آخر استخدام لكل عملة
    - عرض الأرصدة بكل عملة إذا كان ذلك مطلوباً
    - تضمين معلومات عن حساب فروق العملة إذا وجد

- **ValidateAccountCodeQuery (استعلام للتحقق من صحة رمز الحساب)**:
  - الغرض: التحقق من صحة وتفرد رمز حساب جديد قبل الإنشاء
  - المدخلات: رمز الحساب المقترح
  - المخرجات: نتيجة التحقق (متاح/غير متاح) مع سبب عدم الإتاحة إن وجد
  - **منطق الأعمال والتحققات**:
    - التحقق من تفرد الرمز في قاعدة البيانات
    - التحقق من تناسب الرمز مع نمط الترميز المعتمد
    - التحقق من توافق الرمز مع قواعد التسمية المخصصة
    - التحقق من عدم وجود محظورات على استخدام نطاقات معينة من الرموز
    - عرض اقتراحات لرموز بديلة إذا كان الرمز غير متاح
    - التحقق من صلاحيات المستخدم لاستخدام نمط الرمز المقترح

- **GetAccountsForSelectionQuery (استعلام للحصول على قائمة الحسابات للاختيار)**:
  - الغرض: توفير قائمة مختصرة بالحسابات للاستخدام في قوائم الاختيار
  - المدخلات: نوع الحساب (اختياري)، نمط البحث (اختياري)
  - المخرجات: قائمة مختصرة بالحسابات تتضمن الرمز والاسم فقط
  - **منطق الأعمال والتحققات**:
    - التحقق من صلاحيات المستخدم لعرض الحسابات
    - تصفية الحسابات حسب النوع أو معايير أخرى
    - استبعاد الحسابات المعطلة ما لم يتم طلبها صراحةً
    - استبعاد الحسابات التي لا يمكن اختيارها في سياق معين
    - تحسين أداء الاستعلام لدعم التحميل السريع في واجهات المستخدم
    - دعم البحث السريع والتصفية أثناء الكتابة
    - هيكلة البيانات المرجعة بشكل مناسب للعرض في عناصر الاختيار

- **GetAccountHierarchyPathQuery (استعلام للحصول على مسار الحساب الهرمي)**:
  - الغرض: الحصول على المسار الكامل للحساب في التسلسل الهرمي
  - المدخلات: رمز الحساب
  - المخرجات: مسار كامل من الجذر إلى الحساب المحدد
  - **منطق الأعمال والتحققات**:
    - التحقق من وجود الحساب
    - التحقق من صلاحيات المستخدم لعرض مسار الحساب
    - استخدام استراتيجية كفؤة للبحث في الهيكل الهرمي
    - عرض الرمز والاسم لكل حساب في المسار
    - توفير روابط للوصول السريع لكل حساب في المسار
    - دعم تنسيقات مختلفة لعرض المسار (نصي، هيكلي)

- **GetAccountsReportQuery (استعلام لتقرير الحسابات)**:
  - الغرض: إنشاء تقرير مفصل عن الحسابات حسب معايير محددة
  - المدخلات: نوع التقرير، معايير التصفية، خيارات التجميع
  - المخرجات: بيانات التقرير حسب المعايير المحددة
  - **منطق الأعمال والتحققات**:
    - التحقق من صلاحيات المستخدم لعرض التقرير
    - دعم أنواع مختلفة من التقارير (هيكل الحسابات، الأرصدة، الحركات)
    - دعم معايير تصفية متعددة (نوع الحساب، المستوى، الحالة)
    - دعم خيارات تجميع مختلفة (حسب النوع، المستوى، المجموعة)
    - حساب المؤشرات والإحصاءات المطلوبة
    - تنسيق البيانات بشكل مناسب للعرض والطباعة
    - تحسين أداء استخراج البيانات للتقارير الكبيرة

## ملاحظات تقنية إضافية

1. **أمان البيانات**:
   - التحقق من صلاحيات المستخدم قبل تنفيذ أي عملية
   - تشفير البيانات الحساسة
   - تسجيل جميع العمليات في سجل التدقيق

2. **التحقق من صحة البيانات**:
   - التحقق من تفرد رمز الحساب
   - التحقق من صحة العلاقات بين الحسابات
   - التحقق من صحة نوع الحساب والطبيعة والتصنيف

3. **الأداء**:
   - استخدام الفهارس المناسبة لتحسين أداء الاستعلامات
   - تحميل البيانات بشكل محسن (Eager Loading) للعلاقات
   - استخدام الصفحات في الاستعلامات التي تعيد كميات كبيرة من البيانات

4. **قابلية التوسع**:
   - تصميم النظام ليدعم عدد كبير من الحسابات
   - دعم مستويات متعددة من الحسابات (حتى 10 مستويات)
   - دعم العملات المتعددة والحسابات متعددة العملات

5. **دعم التكامل**:
   - واجهة برمجة تطبيقات RESTful لتكامل النظام مع أنظمة أخرى
   - دعم استيراد/تصدير البيانات من/إلى أنظمة أخرى
   - إشعارات وأحداث النطاق لتنبيه الأنظمة الأخرى بالتغييرات 
# الشاشات الفرعية لدليل الحسابات

## 1. شاشة إنشاء حساب جديد

### نظرة عامة
شاشة إنشاء حساب جديد هي شاشة منبثقة تظهر عند النقر على زر "إضافة حساب جديد" في الشاشة الرئيسية لدليل الحسابات. تتيح هذه الشاشة للمستخدم إدخال جميع المعلومات الضرورية لإنشاء حساب جديد في النظام المحاسبي.

### مكونات الشاشة
- **عنوان الشاشة**: "إنشاء حساب جديد"
- **رقم الحساب**:
  - حقل نصي لإدخال رقم الحساب
  - خيار التوليد التلقائي للرقم (زر توليد رقم تلقائي)
  - قواعد التحقق من صحة الرقم حسب هيكل الترقيم المستخدم
- **اسم الحساب بالعربية**: حقل نصي إلزامي
- **اسم الحساب بالإنجليزية**: حقل نصي
- **الحساب الأب**:
  - قائمة منسدلة لاختيار الحساب الأب
  - زر بحث للبحث عن الحساب الأب
  - خيار إنشاء حساب كحساب رئيسي (بدون أب)
- **نوع الحساب**:
  - قائمة اختيار لتحديد نوع الحساب (أصول، خصوم، إيرادات، مصروفات، حقوق ملكية)
  - تحديث تلقائي للخيارات المتاحة بناء على الحساب الأب المحدد
- **الفئة**: قائمة منسدلة لتحديد فئة الحساب (متداولة، ثابتة، متوسطة الأجل، طويلة الأجل)
- **مجموعة الحساب**: قائمة منسدلة لتحديد المجموعة
- **طبيعة الحساب**: اختيار بين (مدين، دائن)
- **حالة الحساب**: قائمة منسدلة (نشط، معطل، مغلق)
- **ملاحظات**: حقل نصي متعدد الأسطر
- **خصائص إضافية**: تبويبات لتحديد الخصائص المتقدمة للحساب:
  - **تبويب العلاقات**:
    - استخدام مراكز التكلفة (نعم/لا) + إلزامي/اختياري
    - استخدام المشاريع (نعم/لا) + إلزامي/اختياري
    - استخدام الأنشطة (نعم/لا) + إلزامي/اختياري
  - **تبويب الإعدادات المتقدمة**:
    - علم إغلاق الحساب في نهاية السنة (نعم/لا)
    - علم الحساب التفصيلي (نعم/لا)
    - نوع تفاصيل الحساب (عملاء، موردين، موظفين، أصول ثابتة، مخزون)
    - استخدام العملات المتعددة (نعم/لا)
    - العملة الافتراضية (قائمة اختيار)
    - علم التأثر بالمعاملات (نعم/لا)
- **أزرار التحكم**:
  - زر حفظ
  - زر حفظ وإضافة حساب جديد
  - زر إلغاء
  - زر مسح الحقول

### قواعد العمل
- يجب أن يكون رقم الحساب فريداً في النظام
- يجب ألا يتعارض رقم الحساب مع هيكل الترقيم المستخدم
- تحديد مستوى الحساب تلقائياً بناءً على موقعه في الهيكل الهرمي
- التحقق من توافق نوع الحساب مع الحساب الأب
- إذا تم تحديد الحساب كتفصيلي، يجب تحديد نوع التفاصيل
- عرض رسالة تأكيد قبل إنشاء الحساب
- إمكانية إنشاء عدة حسابات متتالية دون إغلاق الشاشة (عند اختيار "حفظ وإضافة جديد")

## 2. شاشة تعديل حساب

### نظرة عامة
شاشة تعديل حساب تظهر عند النقر على زر "تعديل" أو النقر المزدوج على حساب في الشاشة الرئيسية. تتيح هذه الشاشة للمستخدم تعديل معلومات الحساب الموجود.

### مكونات الشاشة
- تشبه شاشة إنشاء حساب جديد مع بعض الاختلافات:
  - تعبئة الحقول مسبقاً بمعلومات الحساب الحالية
  - عرض معلومات إضافية (تاريخ الإنشاء، المستخدم الذي أنشأ الحساب، تاريخ آخر تعديل)
  - بعض الحقول قد تكون غير قابلة للتعديل (رقم الحساب) إذا كانت هناك حركات مسجلة
  - زر إضافي "استعادة القيم الأصلية"

### قواعد العمل
- لا يمكن تغيير نوع الحساب إذا كان له حركات مسجلة
- لا يمكن تغيير الحساب الأب إذا كان للحساب حسابات فرعية
- يجب التحقق من الصلاحيات قبل السماح بالتعديل
- تسجيل جميع التغييرات في سجل التغييرات
- عرض تحذير إذا كان التعديل سيؤثر على التقارير المالية المنشورة سابقاً

## 3. شاشة حذف حساب

### نظرة عامة
شاشة تأكيد تظهر عند محاولة حذف حساب. تهدف إلى التأكد من رغبة المستخدم في حذف الحساب وعرض التحذيرات المناسبة.

### مكونات الشاشة
- **عنوان الشاشة**: "تأكيد حذف حساب"
- **معلومات الحساب المراد حذفه**:
  - رقم الحساب
  - اسم الحساب
  - نوع الحساب
- **التحذيرات**:
  - رسالة تحذير عن تبعات الحذف
  - قائمة بالحسابات الفرعية (إن وجدت)
  - إجمالي الحركات المرتبطة (إن وجدت)
- **خيارات الحذف**:
  - حذف الحساب فقط (متاح فقط إذا لم يكن للحساب حسابات فرعية أو حركات)
  - تعطيل الحساب بدلاً من حذفه (الخيار الموصى به إذا كان له تاريخ استخدام)
- **أزرار التحكم**:
  - زر تأكيد الحذف
  - زر إلغاء

### قواعد العمل
- لا يمكن حذف حساب له حركات محاسبية مسجلة (يمكن تعطيله فقط)
- لا يمكن حذف حساب له حسابات فرعية (يجب حذف الحسابات الفرعية أولاً أو نقلها)
- تسجيل عملية الحذف في سجل النظام
- التحقق من الصلاحيات قبل السماح بالحذف

## 4. شاشة استيراد دليل الحسابات

### نظرة عامة
شاشة تتيح للمستخدم استيراد دليل حسابات كامل أو جزئي من ملف خارجي (Excel، CSV، XML). تستخدم عادة عند بدء العمل بالنظام أو استيراد حسابات من نظام آخر.

### مكونات الشاشة
- **عنوان الشاشة**: "استيراد دليل الحسابات"
- **مصدر البيانات**:
  - اختيار نوع الملف (Excel، CSV، XML)
  - زر تصفح لاختيار الملف
  - عرض مسار الملف المختار
- **إعدادات الاستيراد**:
  - تحديد ورقة العمل (في حالة Excel)
  - تحديد الفاصل (في حالة CSV)
  - خيارات ترميز النص
  - تحديد الصف الذي تبدأ منه البيانات
- **تعيين الحقول**:
  - جدول لربط أعمدة الملف مع حقول النظام
  - خيار الكشف التلقائي عن الحقول
  - خيار حفظ قالب التعيين للاستخدام المستقبلي
- **خيارات الاستيراد**:
  - استبدال الحسابات الموجودة (تحديث)
  - إضافة الحسابات الجديدة فقط
  - تخطي الصفوف التي تحتوي على أخطاء
  - استيراد الأرصدة الافتتاحية
- **معاينة البيانات**:
  - جدول يعرض معاينة للبيانات التي سيتم استيرادها
  - تمييز الحسابات الموجودة بالفعل
  - تمييز الصفوف التي تحتوي على أخطاء
- **أزرار التحكم**:
  - زر فحص البيانات (لاكتشاف الأخطاء قبل الاستيراد)
  - زر بدء الاستيراد
  - زر إلغاء

### قواعد العمل
- التحقق من تنسيق الملف المستورد
- التحقق من تطابق هيكل البيانات مع متطلبات النظام
- فحص وجود حسابات مكررة
- التحقق من صحة العلاقات بين الحسابات (الأب/الفرعي)
- إنشاء تقرير بنتائج الاستيراد (ناجح، أخطاء، تحذيرات)
- إمكانية التراجع عن الاستيراد في حالة حدوث أخطاء

## 5. شاشة تصدير دليل الحسابات

### نظرة عامة
شاشة تتيح للمستخدم تصدير دليل الحسابات بالكامل أو جزء منه إلى ملف خارجي بتنسيقات مختلفة.

### مكونات الشاشة
- **عنوان الشاشة**: "تصدير دليل الحسابات"
- **نطاق التصدير**:
  - جميع الحسابات
  - الحسابات المحددة فقط
  - حسب نوع الحساب (أصول، خصوم، إلخ)
  - حسب مستوى الحساب (رئيسية، فرعية)
  - حسب حالة الحساب (نشط، معطل، مغلق)
- **تنسيق التصدير**:
  - Excel
  - CSV
  - XML
  - PDF
  - HTML
- **خيارات التصدير**:
  - تصدير هيكل الحسابات فقط
  - تصدير مع الأرصدة الحالية
  - تصدير مع الحركات
  - تصدير الخصائص المتقدمة
  - تصدير العلاقات (مراكز التكلفة، المشاريع)
- **الحقول المطلوب تصديرها**:
  - قائمة بجميع الحقول المتاحة مع خانات اختيار
  - خيار تحديد الكل
  - خيار إلغاء تحديد الكل
  - ترتيب الحقول (أسهم لأعلى/لأسفل)
- **خيارات التنسيق**:
  - ترميز الملف
  - فاصل العشرات/الآلاف
  - تنسيق الأرقام
  - تنسيق التاريخ
- **إعدادات الملف**:
  - مسار حفظ الملف
  - اسم الملف (مع إمكانية استخدام قوالب مثل تاريخ اليوم)
  - خيار فتح الملف بعد التصدير
- **أزرار التحكم**:
  - زر بدء التصدير
  - زر حفظ إعدادات التصدير (كقالب)
  - زر إلغاء

### قواعد العمل
- التحقق من وجود الحسابات المطلوب تصديرها
- التحقق من صلاحيات المستخدم للوصول إلى البيانات
- إنشاء ملف التصدير بالتنسيق المطلوب
- إنشاء تقرير بنتائج التصدير
- حفظ سجل بعمليات التصدير (من قام بها، متى، ماذا تم تصديره)

## 6. شاشة إدارة أرصدة الحسابات

### نظرة عامة
شاشة تتيح للمستخدم إدارة الأرصدة الافتتاحية للحسابات وإجراء تسويات وتعديلات عليها.

### مكونات الشاشة
- **عنوان الشاشة**: "إدارة أرصدة الحسابات"
- **اختيار الفترة المحاسبية**:
  - قائمة منسدلة للفترات المحاسبية
  - حقل للتاريخ (بداية الفترة/نهاية الفترة)
- **اختيار الحسابات**:
  - شجرة الحسابات للاختيار منها
  - خيار البحث السريع
  - فلترة حسب نوع الحساب
- **جدول الأرصدة**:
  - رقم الحساب
  - اسم الحساب
  - الرصيد الافتتاحي (مدين/دائن)
  - الحركات خلال الفترة (مدين/دائن)
  - الرصيد الختامي (مدين/دائن)
  - العملة
  - حقول قابلة للتعديل (مميزة بلون مختلف)
- **خيارات العرض**:
  - عرض أرصدة العملة الأساسية فقط
  - عرض أرصدة جميع العملات
  - عرض أرصدة مراكز التكلفة
  - عرض أرصدة الفروع
- **ملخص الأرصدة**:
  - إجمالي الأرصدة المدينة
  - إجمالي الأرصدة الدائنة
  - الفرق بينهما (يجب أن يكون صفر)
  - مؤشر التوازن (أخضر متوازن، أحمر غير متوازن)
- **أزرار التحكم**:
  - زر تعديل الأرصدة
  - زر حفظ التغييرات
  - زر استعادة الأرصدة الأصلية
  - زر ترحيل الأرصدة
  - زر طباعة تقرير الأرصدة
  - زر إلغاء

### قواعد العمل
- التحقق من صلاحيات المستخدم لتعديل الأرصدة
- منع تعديل أرصدة الفترات المقفلة
- التأكد من توازن الأرصدة المدينة والدائنة
- التحقق من عدم تعديل أرصدة الحسابات الإجمالية (يتم حسابها تلقائياً)
- تسجيل جميع التعديلات في سجل التغييرات
- إنشاء قيود تسوية تلقائية عند تعديل الأرصدة

## 7. شاشة ترحيل الأرصدة

### نظرة عامة
شاشة تتيح للمستخدم ترحيل أرصدة الحسابات من فترة محاسبية إلى أخرى، وغالباً ما تستخدم في نهاية السنة المالية.

### مكونات الشاشة
- **عنوان الشاشة**: "ترحيل أرصدة الحسابات"
- **الفترات المحاسبية**:
  - الفترة المصدر (من)
  - الفترة الهدف (إلى)
- **خيارات الترحيل**:
  - ترحيل جميع الحسابات
  - ترحيل حسابات محددة (مع إمكانية الاختيار)
  - ترحيل حسابات الميزانية فقط
  - ترحيل حسابات الدخل إلى حساب الأرباح المحتجزة
- **تفاصيل الترحيل**:
  - تاريخ الترحيل
  - وصف قيد الترحيل
  - حساب الأرباح المحتجزة (في حالة إقفال حسابات الدخل)
- **معاينة الترحيل**:
  - جدول يعرض الحسابات التي سيتم ترحيلها
  - الأرصدة القديمة
  - الأرصدة الجديدة بعد الترحيل
- **أزرار التحكم**:
  - زر معاينة الترحيل
  - زر بدء الترحيل
  - زر إلغاء

### قواعد العمل
- التحقق من أن الفترة المصدر مقفلة
- التحقق من أن الفترة الهدف مفتوحة
- التأكد من عدم وجود عمليات ترحيل سابقة للفترة المحددة
- إنشاء قيود الإقفال المناسبة
- تحديث الأرصدة الافتتاحية للفترة الجديدة
- تسجيل عملية الترحيل في سجل النظام
- إنشاء تقرير بنتائج الترحيل

## 8. شاشة إعادة تقييم الحسابات

### نظرة عامة
شاشة تتيح للمستخدم إعادة تقييم حسابات العملات الأجنبية حسب أسعار الصرف الحالية.

### مكونات الشاشة
- **عنوان الشاشة**: "إعادة تقييم حسابات العملات الأجنبية"
- **اختيار العملات**:
  - قائمة بالعملات المستخدمة في النظام
  - أسعار الصرف الحالية
  - إمكانية تعديل أسعار الصرف
- **اختيار الحسابات**:
  - قائمة بالحسابات التي تستخدم عملات أجنبية
  - إمكانية تحديد حسابات محددة
- **معاينة التقييم**:
  - جدول يعرض الحسابات المراد إعادة تقييمها
  - الرصيد بالعملة الأجنبية
  - الرصيد الحالي بالعملة المحلية
  - الرصيد الجديد بعد إعادة التقييم
  - فرق إعادة التقييم (ربح/خسارة)
- **إعدادات إعادة التقييم**:
  - تاريخ إعادة التقييم
  - حساب أرباح فروق العملة
  - حساب خسائر فروق العملة
  - وصف قيد إعادة التقييم
- **أزرار التحكم**:
  - زر معاينة إعادة التقييم
  - زر تنفيذ إعادة التقييم
  - زر إلغاء

### قواعد العمل
- التحقق من صلاحيات المستخدم
- التأكد من وجود أسعار صرف حديثة
- حساب فروق إعادة التقييم لكل حساب
- إنشاء قيود محاسبية لفروق إعادة التقييم
- تحديث أرصدة الحسابات بالقيمة الجديدة
- تسجيل عملية إعادة التقييم في سجل النظام
- إنشاء تقرير بنتائج إعادة التقييم

## 9. شاشة إدارة صلاحيات الحسابات

### نظرة عامة
شاشة تتيح للمدير أو مسؤول النظام تحديد صلاحيات المستخدمين ومجموعات المستخدمين للوصول إلى حسابات معينة في دليل الحسابات.

### مكونات الشاشة
- **عنوان الشاشة**: "إدارة صلاحيات الحسابات"
- **اختيار المستخدمين/المجموعات**:
  - تبويب للمستخدمين
  - تبويب لمجموعات المستخدمين
  - قائمة بالمستخدمين/المجموعات مع خانات اختيار
- **اختيار الحسابات**:
  - شجرة الحسابات للاختيار منها
  - خيار تحديد مستوى معين من الحسابات
  - خيار تحديد نوع معين من الحسابات
- **تحديد الصلاحيات**:
  - جدول لتحديد صلاحيات وصول محددة:
    - عرض (قراءة)
    - تعديل
    - حذف
    - إدخال قيود
    - ترحيل
    - إقفال
    - إعادة فتح
    - عرض الأرصدة
    - تعديل الأرصدة
- **خيارات الصلاحيات**:
  - تطبيق الصلاحيات على الحسابات المحددة فقط
  - تطبيق الصلاحيات على الحسابات المحددة وفروعها
  - تطبيق الصلاحيات على جميع الحسابات
  - نسخ صلاحيات من مستخدم/مجموعة أخرى
- **أزرار التحكم**:
  - زر حفظ الصلاحيات
  - زر إعادة تعيين الصلاحيات الافتراضية
  - زر إلغاء

### قواعد العمل
- التحقق من صلاحيات المستخدم الحالي لإدارة الصلاحيات
- تطبيق مبدأ الوراثة في الصلاحيات (الحسابات الفرعية ترث صلاحيات الحساب الأب ما لم يتم تحديد خلاف ذلك)
- تطبيق مبدأ التراكم في الصلاحيات (المستخدم يحصل على مجموع صلاحيات المجموعات التي ينتمي إليها)
- منع تعارض الصلاحيات (مثل منح صلاحية التعديل بدون صلاحية العرض)
- تسجيل التغييرات في الصلاحيات في سجل النظام
- تطبيق الصلاحيات الجديدة فوراً 
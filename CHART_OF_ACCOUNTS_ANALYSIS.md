# تحليل شاشة دليل الحسابات (Chart of Accounts) - نظام ERP Pro (مستوحى من Onyx Pro)

## 1. مقدمة وغرض الشاشة

شاشة دليل الحسابات هي الشاشة المركزية في أي نظام ERP لإدارة وتصنيف جميع الحسابات المالية للمؤسسة. تُعتبر العمود الفقري للنظام المحاسبي، حيث تُستخدم لتنظيم وتسجيل جميع المعاملات المالية وتوليد التقارير المالية. تهدف هذه الشاشة إلى:

*   **إنشاء وتعديل وحذف الحسابات:** إضافة حسابات جديدة، تعديل بيانات حسابات قائمة، وحذف الحسابات (مع قيود).
*   **تحديد هيكلية الحسابات:** بناء هيكل شجري (Tree Structure) يوضح تبعية الحسابات وعلاقاتها (رئيسي وفرعي).
*   **تصنيف الحسابات:** تحديد نوع كل حساب (أصول، خصوم، حقوق ملكية، إيرادات، مصروفات) وطبيعته والغرض منه.
*   **تحديد خصائص الحساب:** ضبط الإعدادات الخاصة بكل حساب مثل العملة، إمكانية إدخال حركات، الربط بمراكز التكلفة والمشاريع، إلخ.
*   **الاستعلام والبحث:** توفير طرق سهلة للبحث عن حسابات محددة أو استعراض الهيكل المحاسبي.

**ملاحظة حول الاكتمال:** هذا التحليل يعتمد على المعلومات المجمعة من سكربت قاعدة البيانات، ملف توصيف الشاشات العام (`screens.md`)، والممارسات القياسية في أنظمة ERP. قد لا يعكس 100% من التفاصيل الدقيقة لشاشة نظام أونكس برو الفعلية بسبب الطبيعة المغلقة للنظام.

## 2. تصميم الشاشة المتوقع (Layout)

عادةً ما تتكون شاشة دليل الحسابات من الأجزاء التالية:

*   **لوحة عرض شجرية (Tree View Panel):**
    *   تعرض الهيكل الهرمي للحسابات.
    *   تسمح بتوسيع وطي الحسابات الرئيسية لعرض الحسابات الفرعية.
    *   تُستخدم للتنقل السريع بين الحسابات.
    *   قد تُظهر رمز الحساب واسمه في العرض الشجري.
*   **لوحة التفاصيل (Details Panel):**
    *   تعرض جميع حقول وبيانات الحساب المحدد حاليًا في العرض الشجري.
    *   تحتوي على الحقول اللازمة لإدخال وتعديل بيانات الحساب.
    *   قد تكون مقسمة إلى تبويبات (Tabs) لتنظيم الحقول (مثل: بيانات أساسية، إعدادات إضافية، ربط تحليلي، عملات، إلخ).
*   **شريط أدوات (Toolbar) / أزرار أوامر (Command Buttons):**
    *   أزرار لـ: إضافة جديد، حفظ، حذف، بحث، طباعة، تحديث/إعادة تحميل، ربما استيراد/تصدير.
    *   قد تحتوي على حقل بحث سريع.

## 3. الحقول الرئيسية المتوقعة (Fields)

بناءً على تحليل جدول `ACCOUNT` والجداول المرتبطة والممارسات القياسية:

| الحقل المقترح (الاسم التقريبي) | اسم العمود المحتمل (SQL) | النوع المتوقع | الوصف                                                                                                                                                              | ملاحظات / منطق أعمال مرتبط                                                                                                                                                                                            |
| :----------------------------- | :----------------------- | :------------ | :----------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **رمز الحساب**                 | `A_CODE`                 | نص (Varchar)  | المعرف الفريد للحساب. غالبًا ما يكون رقميًا أو أبجديًا رقميًا، وقد يكون مقسمًا (Segmented).                                                                          | *إلزامي، فريد*. قد يخضع لقناع إدخال (Input Mask) أو طول محدد.                                                                                                                                                         |
| **اسم الحساب (عربي)**          | `A_NAME`                 | نص (Varchar)  | الاسم الوصفي للحساب باللغة الأساسية.                                                                                                                                 | *إلزامي*.                                                                                                                                                                                                             |
| **اسم الحساب (إنجليزي)**       | `A_NAME_ENG`             | نص (Varchar)  | الاسم الوصفي للحساب بلغة ثانية (الإنجليزية).                                                                                                                       | اختياري، مفيد للشركات متعددة اللغات.                                                                                                                                                                                  |
| **المستوى**                    | `A_LEVEL`                | رقم (Number) | مستوى الحساب في الهيكل الشجري (1 هو المستوى الأعلى).                                                                                                              | *إلزامي*. يتم تحديده غالبًا تلقائيًا عند اختيار الحساب الأب.                                                                                                                                                          |
| **الحساب الأب**                 | `A_PARENT`               | نص (Varchar)  | رمز الحساب الرئيسي الذي يتبعه هذا الحساب.                                                                                                                          | *إلزامي* (ما عدا حسابات المستوى الأعلى). يجب أن يكون حسابًا رئيسيًا (غير تحليلي). يتم اختياره من قائمة أو بالبحث.                                                                                                      |
| **نوع الحساب (رئيسي/فرعي)**    | `A_S_M` (?)              | رقم/قائمة     | يحدد ما إذا كان الحساب رئيسيًا (لتجميع الحسابات الفرعية، لا يقبل حركات) أم فرعيًا (تحليليًا، يقبل حركات).                                                           | *إلزامي*. الحسابات الرئيسية لا يمكن إجراء قيود عليها مباشرة.                                                                                                                                                         |
| **نوع الحساب (التصنيف)**      | (من `ACCOUNT_TYPES`)     | قائمة         | التصنيف الأساسي للحساب (أصول، خصوم، حقوق ملكية، إيرادات، مصروفات).                                                                                                | *إلزامي*. يحدد كيفية ظهور الحساب في القوائم المالية. قد يؤثر على طبيعة الرصيد (مدين/دائن). (`ACCOUNT_TYPES.ACCOUNT_TYPE` -> `ACCOUNT.CLASS_NO` ?)                                                                   |
| **طبيعة الحساب (مدين/دائن)**   | `DR` (?)                 | قائمة/منطقية  | يحدد الطبيعة الافتراضية لرصيد الحساب (مدين أو دائن).                                                                                                               | غالبًا ما يتم تحديده بناءً على نوع الحساب (الأصول والمصروفات مدينة، الخصوم وحقوق الملكية والإيرادات دائنة).                                                                                                             |
| **مجموعة الحساب**              | `A_GROUPING`             | قائمة         | تجميع إضافي للحسابات لأغراض التقارير أو التحليل (يُربط بجدول `ACCOUNT_GROUPING`).                                                                                   | اختياري.                                                                                                                                                                                                             |
| **نوع التقرير**                | `A_REPORT`               | قائمة         | يحدد في أي تقرير مالي رئيسي سيظهر الحساب (ميزانية، قائمة دخل، إلخ) (يُربط بجدول `ACCOUNT_REPORT_TYPE`).                                                          | *إلزامي*. ضروري لتوليد القوائم المالية الصحيحة.                                                                                                                                                                       |
| **التحليل المالي**             | `A_ANALYSIS`             | قائمة         | ربط الحساب بتحليل مالي معين (يُربط بجدول `IAS_ACCOUNT_ANLSYS`).                                                                                                    | اختياري.                                                                                                                                                                                                             |
| **تصنيف الحساب**              | `CLASS_NO`               | قائمة         | تصنيف إضافي للحساب (يُربط بجدول `IAS_ACCOUNT_CLASS`).                                                                                                              | اختياري.                                                                                                                                                                                                             |
| **حساب إقفال**                | `AC_CLOSE`               | منطقي (Checkbox) | هل هذا الحساب يستخدم في قيود الإقفال السنوية؟                                                                                                                    | يستخدم في عملية إقفال السنة المالية.                                                                                                                                                                                |
| **حساب فروقات العملة**         | `CURDIF_CODE`            | قائمة/بحث     | الحساب الذي يتم تحميل فروقات تقييم العملة عليه لهذا الحساب (إذا كان الحساب بعملة أجنبية).                                                                          | يظهر إذا كان الحساب متعدد العملات.                                                                                                                                                                                 |
| **يتطلب مركز تكلفة**          | `USE_CC`                 | منطقي (Checkbox) | هل يجب تحديد مركز تكلفة عند إجراء قيد على هذا الحساب؟                                                                                                             | يفرض إدخال مركز تكلفة في شاشات القيود.                                                                                                                                                                                |
| **يتطلب مشروع**                | `USE_PJ`                 | منطقي (Checkbox) | هل يجب تحديد مشروع عند إجراء قيد على هذا الحساب؟                                                                                                                  | يفرض إدخال رقم مشروع في شاشات القيود.                                                                                                                                                                                 |
| **يتطلب نشاط**                | `USE_ACTV`               | منطقي (Checkbox) | هل يجب تحديد نشاط عند إجراء قيد على هذا الحساب؟                                                                                                                   | يفرض إدخال رقم نشاط في شاشات القيود.                                                                                                                                                                                  |
| **نوع الحساب التفصيلي**       | `AC_DTL_TYP`             | قائمة         | يحدد ما إذا كان الحساب مرتبطًا بحسابات تحليلية فرعية (عملاء، موردين، موظفين، بنوك، أصول ثابتة، مخزون).                                                              | *حقل مهم جدًا*. يحدد نوع الحساب المساعد الذي يجب ربطه. (0=عام، 1=عميل، 2=مورد، إلخ). لا يمكن إجراء قيد مباشر على الحساب الرئيسي إذا كان له نوع تفصيلي.                                                                |
| **العملات المسموحة**          | (من `ACCOUNT_CURR`)      | قائمة متعددة   | قائمة بالعملات التي يمكن استخدامها في المعاملات الخاصة بهذا الحساب.                                                                                                 | يظهر في تبويب منفصل غالبًا. يسمح بتحديد عملة أو أكثر. يتطلب وجود جدول ربط مثل `ACCOUNT_CURR`.                                                                                                                       |
| **حساب مفضل**                 | `FAV_AC`                 | منطقي (Checkbox) | لوضع علامة على الحساب لتسهيل الوصول إليه في بعض الشاشات.                                                                                                          | اختياري.                                                                                                                                                                                                             |
| **نوع التدفق النقدي**          | `FLOW_TYPE`              | قائمة         | لتصنيف الحساب ضمن تقرير التدفقات النقدية (تشغيلي، استثماري، تمويلي).                                                                                                | اختياري.                                                                                                                                                                                                             |
| **نشط/غير نشط**              | (مشتق من `INACTIVE_DATE`) | منطقي (Checkbox) | يحدد ما إذا كان الحساب يمكن استخدامه في المعاملات الجديدة.                                                                                                        | الحسابات غير النشطة لا تظهر في قوائم الاختيار في شاشات القيود. قد يكون مرتبطًا بالحقلين `INACTIVE_DATE` و `INACTIVE_RES`.                                                                                                 |
| **سبب عدم النشاط**            | `INACTIVE_RES`           | نص (Varchar)  | نص يوضح سبب جعل الحساب غير نشط.                                                                                                                                  | اختياري، يظهر إذا كان الحساب غير نشط.                                                                                                                                                                                 |
| **تاريخ عدم النشاط**           | `INACTIVE_DATE`          | تاريخ (Date)  | التاريخ الذي تم فيه جعل الحساب غير نشط.                                                                                                                            | اختياري، يظهر إذا كان الحساب غير نشط.                                                                                                                                                                                 |
| **نوع المصروف**               | `AC_EXP_TYPE`            | قائمة         | لتصنيف إضافي إذا كان الحساب حساب مصروف.                                                                                                                           | يظهر فقط لحسابات المصروفات.                                                                                                                                                                                          |
| **يستخدم في مصروفات الفروع**   | `USE_EXP_BRN`            | منطقي (Checkbox) | هل هذا الحساب يستخدم لتسجيل مصروفات الفروع؟                                                                                                                     | اختياري.                                                                                                                                                                                                             |
| **ضريبة الخصم من المنبع**     | `USE_TDS_FLG`            | منطقي (Checkbox) | هل يخضع هذا الحساب لضريبة الخصم من المنبع؟                                                                                                                       | يظهر في سياق معين حسب قوانين الضرائب.                                                                                                                                                                                |
| **سلف/مصروفات/إيرادات مؤجلة** | `ADVNC_EXPNS_RVNU_FLG`   | قائمة/منطقية  | لتحديد ما إذا كان الحساب يستخدم للسلف أو المصروفات المدفوعة مقدماً أو الإيرادات غير المكتسبة.                                                                     | يستخدم في التسويات المحاسبية.                                                                                                                                                                                        |
| **حقول التدقيق**              | `AD_U_ID`, `AD_DATE`...  | (متعدد)       | معلومات حول من أنشأ الحساب ومتى، ومن آخر من عدله ومتى.                                                                                                             | عادةً ما تكون للقراءة فقط أو تملأ تلقائيًا بواسطة النظام.                                                                                                                                                            |

## 4. منطق الأعمال والقواعد (Business Logic & Validations)

*   **تكويد الحسابات:** يجب أن يكون رمز الحساب فريدًا. قد يكون هناك منطق لتوليد الأرقام تلقائيًا أو التحقق من طول/صيغة الرمز.
*   **هيكلية الشجرة:** لا يمكن جعل حساب فرعي (يقبل حركات) أبًا لحساب آخر. الحساب الأب يجب أن يكون حسابًا رئيسيًا. لا يمكن حذف حساب رئيسي لديه حسابات فرعية.
*   **الحسابات الرئيسية والفرعية:** لا يمكن إدخال حركات مالية مباشرة على الحسابات الرئيسية. الحركات تتم فقط على الحسابات الفرعية (التحليلية).
*   **الحسابات التحليلية (الوسيطة):** إذا تم تحديد "نوع حساب تفصيلي" (مثل عملاء، موردين)، فلا يمكن إجراء قيد مباشر على هذا الحساب في دفتر الأستاذ العام، بل يجب استخدام الحساب التحليلي المقابل (حساب العميل/المورد المحدد) في الشاشات الفرعية (فواتير المبيعات/المشتريات).
*   **الحالة (نشط/غير نشط):** لا يمكن استخدام حساب غير نشط في معاملات جديدة.
*   **الحذف:** لا يمكن حذف حساب لديه حركات مسجلة أو رصيد غير صفري. قد يتم وضع علامة "غير نشط" بدلاً من الحذف الفعلي.
*   **الربط الإلزامي:** إذا تم تحديد "يتطلب مركز تكلفة" أو "يتطلب مشروع" أو "يتطلب نشاط"، سيقوم النظام بفرض إدخال هذه الأبعاد عند استخدام الحساب في القيود.
*   **العملات:** إذا كان الحساب مقيدًا بعملة معينة، فلا يمكن إجراء حركات عليه بعملات أخرى إلا إذا تم السماح بذلك وتم تحديد حساب فروقات عملة.
*   **توازن دليل الحسابات:** يجب أن يضمن تصميم الدليل توازن المعادلة المحاسبية (الأصول = الخصوم + حقوق الملكية).
*   **صلاحيات المستخدمين:** قد تكون هناك صلاحيات محددة لإنشاء أو تعديل أو حذف الحسابات أو الاطلاع عليها.

## 5. تدفق البيانات (Data Flow)

*   **الإدخال:**
    *   يتم إنشاء الحسابات وتعديلها يدويًا من خلال هذه الشاشة.
    *   قد يكون هناك خيار لاستيراد دليل الحسابات من ملف خارجي (مثل Excel)، خاصة عند إعداد النظام لأول مرة (كما يلمح حقل `IMP_XLS`).
*   **الاستخدام:**
    *   **تسجيل المعاملات:** يتم اختيار الحسابات الفرعية من دليل الحسابات عند تسجيل جميع أنواع المعاملات المالية (قيود يومية، فواتير، سندات قبض/صرف، حركات مخزون، إهلاك أصول، رواتب، إلخ).
    *   **التقارير المالية:** يُستخدم هيكل دليل الحسابات وتصنيفاته لتوليد التقارير المالية الأساسية (ميزان المراجعة، قائمة الدخل، الميزانية العمومية، قائمة التدفقات النقدية) والتقارير التحليلية الأخرى.
    *   **الموازنات:** يتم إعداد الموازنات التقديرية بناءً على حسابات دليل الحسابات.
    *   **التكامل:** يعتبر دليل الحسابات نقطة تكامل مركزية تربط جميع الوحدات المالية والإدارية الأخرى (المبيعات، المشتريات، المخزون، الأصول، الموارد البشرية).

## 6. اعتبارات إضافية

*   **تعدد الشركات/الفروع:** في بيئة متعددة الشركات أو الفروع، قد يكون دليل الحسابات موحدًا على مستوى الشركة القابضة مع إمكانية تخصيص بعض الحسابات لفروع معينة، أو قد يكون لكل شركة/فرع دليل حسابات مستقل أو مشترك جزئيًا.
*   **الأبعاد التحليلية (Dimensions):** بالإضافة إلى مراكز التكلفة والمشاريع والأنشطة، قد تدعم أنظمة ERP الحديثة أبعادًا تحليلية إضافية يمكن ربطها بالحسابات لتوفير مرونة أكبر في التقارير.

---
آمل أن يوفر هذا التحليل المفصل رؤية شاملة لشاشة دليل الحسابات والمنطق المرتبط بها، مع الأخذ في الاعتبار القيود المذكورة حول المصادر المتاحة. 